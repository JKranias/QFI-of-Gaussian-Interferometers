(* Content-type: application/vnd.wolfram.mathematica *)

(*** Wolfram Notebook File ***)
(* http://www.wolfram.com/nb *)

(* CreatedBy='Mathematica 13.1' *)

(*CacheID: 234*)
(* Internal cache information:
NotebookFileLineBreakTest
NotebookFileLineBreakTest
NotebookDataPosition[       158,          7]
NotebookDataLength[     78556,       2014]
NotebookOptionsPosition[     77648,       1991]
NotebookOutlinePosition[     78041,       2007]
CellTagsIndexPosition[     77998,       2004]
WindowFrame->Normal*)

(* Beginning of Notebook Content *)
Notebook[{
Cell[BoxData[
 RowBox[{
  RowBox[{"(*", 
   RowBox[{
    RowBox[{
     RowBox[{"(", "C", ")"}], " ", "Copyright", " ", "Jasper", " ", 
     "Kranias"}], ",", 
    RowBox[{
    "2023.", "\n", "This", " ", "code", " ", "is", " ", "licensed", " ", 
     "under", " ", "the", " ", "Apache", " ", "License"}], ",", 
    RowBox[{
     RowBox[{"Version", " ", 
      RowBox[{"2.0", ".", "You"}], " ", "may", "\n", "obtain", " ", "a", " ", 
      "copy", " ", "of", " ", "this", " ", "license", " ", "in", " ", "the", 
      " ", 
      RowBox[{"LICENSE", ".", "txt"}], " ", "file", " ", "in", " ", "the", 
      " ", "root", " ", "directory", "\n", "of", " ", "this", " ", "source", 
      " ", "tree", " ", "or", " ", "at", " ", 
      RowBox[{"http", ":"}]}], "//", 
     RowBox[{
      RowBox[{
       RowBox[{
        RowBox[{"www", ".", "apache", ".", "org"}], "/", "licenses"}], "/", 
       "LICENSE"}], "-", 
      RowBox[{
       RowBox[{"2.0", ".", "#"}], "\n", "Any", " ", "modifications", " ", 
       "or", " ", "derivative", " ", "works", " ", "of", " ", "this", " ", 
       "code", " ", "must", " ", "retain", " ", "this", "\n", "copyright", 
       " ", "notice"}]}]}], ",", 
    RowBox[{
    "and", " ", "modified", " ", "files", " ", "need", " ", "to", " ", 
     "carry", " ", "a", " ", "notice", " ", "indicating", "\n", "that", " ", 
     "they", " ", "have", " ", "been", " ", "altered", " ", "from", " ", 
     "the", " ", 
     RowBox[{"originals", "."}]}]}], "\[IndentingNewLine]", "*)"}], 
  "\[IndentingNewLine]", "\[IndentingNewLine]", "\[IndentingNewLine]", 
  RowBox[{"(*", 
   RowBox[{
    RowBox[{
    "this", " ", "code", " ", "can", " ", "compute", " ", "the", " ", 
     "output", " ", "Gaussian", " ", "state", " ", "of", " ", "a", " ", 
     "Gaussian", " ", "interferometer"}], ",", " ", 
    RowBox[{
    "and", " ", "then", " ", "find", " ", "the", " ", "quantum", " ", 
     "Fisher", " ", "information", " ", 
     RowBox[{"(", "QFI", ")"}]}]}], "*)"}], "\[IndentingNewLine]", 
  "\[IndentingNewLine]", "\[IndentingNewLine]", 
  RowBox[{"(*", 
   RowBox[{
   "to", " ", "find", " ", "the", " ", "gaussian", " ", "state", " ", "after",
     " ", "the", " ", "oporations", " ", "of", " ", "the", " ", 
    "interferometer", " ", "setup", " ", "we", " ", "use", " ", "the", " ", 
    "formalism", " ", "in", " ", 
    "\"\<Gaussian states and operations \[Dash] a quick reference\>\"", " ", 
    "by", " ", "Jonatan", " ", "Bohr", " ", "Brask", " ", 
    RowBox[{"(", 
     RowBox[{
      RowBox[{"https", ":"}], "//", 
      RowBox[{
       RowBox[{
        RowBox[{"arxiv", ".", "org"}], "/", "pdf"}], "/", 
       RowBox[{"2102.05748", ".", "pdf"}]}]}], ")"}]}], " ", "*)"}], 
  "\[IndentingNewLine]", 
  RowBox[{"(*", 
   RowBox[{
    RowBox[{"v", " ", "is", " ", 
     RowBox[{"r", "^", "bar"}]}], ",", " ", 
    RowBox[{"s", " ", "is", " ", "covariance", " ", "matrix"}], ",", " ", 
    RowBox[{"a1", " ", "is", " ", "Re", 
     RowBox[{"(", "alpha", ")"}]}], ",", " ", 
    RowBox[{"a2", " ", "is", " ", "Im", 
     RowBox[{"(", "alpha", ")"}]}], ",", " ", "etc"}], "*)"}], 
  "\[IndentingNewLine]", 
  RowBox[{"(*", 
   RowBox[{
   "t", " ", "is", " ", "used", " ", "in", " ", "place", " ", "of", " ", 
    "theta"}], "*)"}], "\[IndentingNewLine]", "\[IndentingNewLine]", 
  "\[IndentingNewLine]", 
  RowBox[{"(*", 
   RowBox[{
   "identity", " ", "matrix", " ", "of", " ", "dimension", " ", "n", " ", 
    "by", " ", "n"}], "*)"}], "\[IndentingNewLine]", 
  RowBox[{
   RowBox[{
    RowBox[{"id", "[", "n_", "]"}], ":=", 
    RowBox[{
     RowBox[{"id", "[", "n", "]"}], "=", 
     RowBox[{"IdentityMatrix", "[", "n", "]"}]}]}], "\[IndentingNewLine]", 
   "\[IndentingNewLine]", 
   RowBox[{"(*", 
    RowBox[{
    "Permutation", " ", "matrix", " ", "of", " ", "desired", " ", 
     "permutation", " ", "in", " ", "n", " ", "dim"}], "*)"}], 
   "\[IndentingNewLine]", 
   RowBox[{"(*", 
    RowBox[{
     RowBox[{
     "perm", " ", "is", " ", "a", " ", "list", " ", "of", " ", "numbers"}], 
     ",", " ", 
     RowBox[{"and", " ", "the", " ", "output", " ", 
      RowBox[{"P", "[", "perm", "]"}], " ", "is", " ", "a", " ", "matrix", 
      " ", "which", " ", "permutes", " ", "the", " ", "entires", " ", "of", 
      " ", "a", " ", "vector", " ", "to", " ", "that", " ", "order"}]}], 
    "*)"}], "\[IndentingNewLine]", 
   RowBox[{"(*", " ", 
    RowBox[{
     RowBox[{
      RowBox[{"ex", ".", " ", "perm"}], "=", 
      RowBox[{"{", 
       RowBox[{"3", ",", "2", ",", "1", ",", "4"}], "}"}]}], ",", " ", 
     RowBox[{
      RowBox[{
       RowBox[{"P", "[", "perm", "]"}], ".", 
       RowBox[{"{", 
        RowBox[{"a", ",", "b", ",", "c", ",", "d"}], "}"}]}], "=", 
      RowBox[{"{", 
       RowBox[{"c", ",", "b", ",", "a", ",", "d"}], "}"}]}]}], " ", "*)"}], 
   "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"P", "[", "perm_", "]"}], ":=", 
    RowBox[{
     RowBox[{"Permute", "[", 
      RowBox[{
       RowBox[{"id", "[", 
        RowBox[{"Length", "[", "perm", "]"}], "]"}], ",", 
       RowBox[{"PermutationCycles", "[", "perm", "]"}]}], "]"}], 
     "\[Transpose]"}]}], "\[IndentingNewLine]", "\[IndentingNewLine]", 
   "\[IndentingNewLine]", 
   RowBox[{"a1", "=."}], "\[IndentingNewLine]", 
   RowBox[{"a2", "=."}], "\[IndentingNewLine]", 
   RowBox[{"b1", "=."}], "\[IndentingNewLine]", 
   RowBox[{"b2", "=."}], "\[IndentingNewLine]", 
   RowBox[{"c1", "=."}], "\[IndentingNewLine]", 
   RowBox[{"c2", "=."}], "\[IndentingNewLine]", 
   RowBox[{"(*", 
    RowBox[{
    "we", " ", "start", " ", "with", " ", "an", " ", "initial", " ", "v", " ",
      "and", " ", "s", " ", "written", " ", "below"}], "*)"}], 
   "\[IndentingNewLine]", "\[IndentingNewLine]", 
   RowBox[{"(*", 
    RowBox[{
    "initial", " ", "means", " ", "vector", " ", "with", " ", "coherent", " ",
      "seeding", " ", "in", " ", "a", " ", "and", " ", "b"}], "*)"}], 
   "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"v0", "=", 
     RowBox[{
      RowBox[{"Sqrt", "[", "2", "]"}], 
      RowBox[{"{", 
       RowBox[{"a1", ",", "a2", ",", "b1", ",", "b2", ",", "c1", ",", "c2"}], 
       "}"}]}]}], ";"}], "\[IndentingNewLine]", "\[IndentingNewLine]", 
   RowBox[{"(*", 
    RowBox[{"initial", " ", "covariance", " ", "matrix"}], "*)"}], 
   "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"s0", "=", 
     RowBox[{
      RowBox[{"(", 
       RowBox[{"1", "/", "2"}], ")"}], "*", 
      RowBox[{"id", "[", "6", "]"}]}]}], ";"}], "\[IndentingNewLine]", 
   "\[IndentingNewLine]", "\[IndentingNewLine]", 
   RowBox[{"(*", 
    RowBox[{
    "the", " ", "following", " ", "lists", " ", "are", " ", "permuataions", 
     " ", "pmn", " ", "which", " ", "are", " ", "used", " ", "when", " ", 
     "modes", " ", "m", " ", "and", " ", "n", " ", "are", " ", "transformed", 
     " ", 
     RowBox[{"(", 
      RowBox[{
      "or", " ", "pm", " ", "if", " ", "a", " ", "single", " ", "mode", " ", 
       "m", " ", "is", " ", "transformed"}], ")"}]}], "*)"}], 
   "\[IndentingNewLine]", "\[IndentingNewLine]", 
   RowBox[{"(*", 
    RowBox[{
    "for", " ", "operations", " ", "which", " ", "affect", " ", "one", " ", 
     "mode"}], "*)"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"pa", "=", 
     RowBox[{"{", 
      RowBox[{"1", ",", "2", ",", "3", ",", "4", ",", "5", ",", "6"}], 
      "}"}]}], ";"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"pb", "=", 
     RowBox[{"{", 
      RowBox[{"3", ",", "4", ",", "1", ",", "2", ",", "5", ",", "6"}], 
      "}"}]}], ";"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"pc", "=", 
     RowBox[{"{", 
      RowBox[{"5", ",", "6", ",", "1", ",", "2", ",", "3", ",", "4"}], 
      "}"}]}], ";"}], "\[IndentingNewLine]", "\[IndentingNewLine]", 
   RowBox[{"(*", 
    RowBox[{
    "for", " ", "operations", " ", "which", " ", "affect", " ", "two", " ", 
     "modes"}], "*)"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"pab", "=", 
     RowBox[{"{", 
      RowBox[{"1", ",", "2", ",", "3", ",", "4", ",", "5", ",", "6"}], 
      "}"}]}], ";"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"pac", "=", 
     RowBox[{"{", 
      RowBox[{"1", ",", "2", ",", "5", ",", "6", ",", "3", ",", "4"}], 
      "}"}]}], ";"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"pbc", "=", 
     RowBox[{"{", 
      RowBox[{"3", ",", "4", ",", "5", ",", "6", ",", "1", ",", "2"}], 
      "}"}]}], ";"}], "\[IndentingNewLine]", "\[IndentingNewLine]", 
   RowBox[{"(*", 
    RowBox[{
     RowBox[{"for", " ", "loss"}], ",", " ", 
     RowBox[{
     "which", " ", "affects", " ", "one", " ", "mode", " ", "and", " ", "a", 
      " ", "ficticious", " ", "mode"}]}], "*)"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"paf", "=", 
     RowBox[{"{", 
      RowBox[{
      "1", ",", "2", ",", "7", ",", "8", ",", "3", ",", "4", ",", "5", ",", 
       "6"}], "}"}]}], ";"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"pbf", "=", 
     RowBox[{"{", 
      RowBox[{
      "3", ",", "4", ",", "7", ",", "8", ",", "1", ",", "2", ",", "5", ",", 
       "6"}], "}"}]}], ";"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"pcf", "=", 
     RowBox[{"{", 
      RowBox[{
      "5", ",", "6", ",", "7", ",", "8", ",", "1", ",", "2", ",", "3", ",", 
       "4"}], "}"}]}], ";"}], "\[IndentingNewLine]", "\[IndentingNewLine]", 
   "\[IndentingNewLine]", 
   RowBox[{"(*", 
    RowBox[{
    "the", " ", "following", " ", "sections", " ", "for", " ", "each", " ", 
     "Gaussian", " ", "operation", " ", "OP", " ", "define", " ", "the", " ", 
     "matrix", " ", "FOP", " ", "which", " ", "transforms", " ", "s", " ", 
     "as", " ", 
     RowBox[{"F", ".", "s", ".", 
      RowBox[{"F", "\[Transpose]"}]}], " ", "and", " ", "v", " ", "as", " ", 
     RowBox[{"F", ".", "v"}]}], "*)"}], "\[IndentingNewLine]", 
   "\[IndentingNewLine]", 
   RowBox[{"(*", 
    RowBox[{
     RowBox[{
     "each", " ", "operation", " ", "starts", " ", "with", " ", "a", " ", 
      "smaller", " ", "matrix", " ", "f", " ", "which", " ", "affects", " ", 
      "one", " ", "or", " ", "two", " ", "modes"}], ",", " ", 
     RowBox[{
     "then", " ", "f", " ", "is", " ", "used", " ", "along", " ", "with", " ",
       "an", " ", "identity", " ", "matrix", " ", "to", " ", "form", " ", "a",
       " ", "block", " ", "matrix", " ", "F", " ", "in", " ", "the", " ", 
      "space", " ", "of", " ", "all", " ", "modes"}], ",", " ", 
     RowBox[{
     "then", " ", "the", " ", "block", " ", "matrix", " ", "is", " ", 
      "multiplied", " ", "by", " ", "permuation", " ", "matrices", " ", "as", 
      " ", 
      RowBox[{
       RowBox[{"P", "^", 
        RowBox[{"(", 
         RowBox[{"-", "1"}], ")"}]}], ".", "F", ".", "P"}], " ", "so", " ", 
      "it", " ", "acts", " ", "on", " ", "the", " ", "correct", " ", 
      "modes"}]}], "*)"}], "\[IndentingNewLine]", "\[IndentingNewLine]", 
   RowBox[{"(*", 
    RowBox[{
     RowBox[{
     "each", " ", "section", " ", "also", " ", "defines", " ", "the", " ", 
      "functions", " ", "OPs", " ", "and", " ", "OPv", " ", "which", " ", 
      "output", " ", "the", " ", "resulting", " ", "s", " ", "and", " ", "v", 
      " ", "from", " ", "the", " ", "operation"}], ",", " ", 
     RowBox[{"given", " ", "the", " ", "input"}]}], "*)"}], 
   "\[IndentingNewLine]", "\[IndentingNewLine]", "\[IndentingNewLine]", 
   RowBox[{"(*", 
    RowBox[{"TWO", " ", "MODE", " ", "SQUEEZING", " ", 
     RowBox[{"(", "TMS", ")"}]}], "*)"}], "\[IndentingNewLine]", 
   "\[IndentingNewLine]", 
   RowBox[{"(*", 
    RowBox[{"S_theta", " ", "matrix", " ", "used", " ", "in", " ", "fTMS"}], 
    "*)"}], "\[IndentingNewLine]", 
   RowBox[{"(*", 
    RowBox[{"input", " ", "the", " ", "squeezing", " ", "phase", " ", "t"}], 
    "*)"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"St", "[", "t_", "]"}], ":=", 
    RowBox[{"{", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{
        RowBox[{"Cos", "[", "t", "]"}], ",", 
        RowBox[{"Sin", "[", "t", "]"}]}], "}"}], ",", 
      RowBox[{"{", 
       RowBox[{
        RowBox[{"Sin", "[", "t", "]"}], ",", 
        RowBox[{"-", 
         RowBox[{"Cos", "[", "t", "]"}]}]}], "}"}]}], "}"}]}], 
   "\[IndentingNewLine]", "\[IndentingNewLine]", 
   RowBox[{"(*", 
    RowBox[{"f", " ", "for", " ", "TMS"}], "*)"}], "\[IndentingNewLine]", 
   RowBox[{"(*", 
    RowBox[{
    "input", " ", "the", " ", "squeezing", " ", "magnitude", " ", "r", " ", 
     "and", " ", "phase", " ", "t"}], "*)"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"fTMS", "[", 
     RowBox[{"r_", ",", "t_"}], "]"}], ":=", 
    RowBox[{"ArrayFlatten", "[", 
     RowBox[{"{", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{
         RowBox[{
          RowBox[{"Cosh", "[", "r", "]"}], "*", 
          RowBox[{"id", "[", "2", "]"}]}], ",", 
         RowBox[{
          RowBox[{"-", 
           RowBox[{"Sinh", "[", "r", "]"}]}], "*", 
          RowBox[{"St", "[", "t", "]"}]}]}], "}"}], ",", 
       RowBox[{"{", 
        RowBox[{
         RowBox[{
          RowBox[{"-", 
           RowBox[{"Sinh", "[", "r", "]"}]}], "*", 
          RowBox[{"St", "[", "t", "]"}]}], ",", 
         RowBox[{
          RowBox[{"Cosh", "[", "r", "]"}], "*", 
          RowBox[{"id", "[", "2", "]"}]}]}], "}"}]}], "}"}], "]"}]}], 
   "\[IndentingNewLine]", "\[IndentingNewLine]", 
   RowBox[{"(*", 
    RowBox[{"F", " ", "for", " ", "TMS"}], "*)"}], "\[IndentingNewLine]", 
   RowBox[{"(*", 
    RowBox[{
     RowBox[{"input", " ", "either", " ", "s", " ", "or", " ", "v", " ", 
      RowBox[{"(", 
       RowBox[{
       "it", " ", "is", " ", "only", " ", "to", " ", "get", " ", "the", " ", 
        "correct", " ", "dimension"}], ")"}]}], ",", " ", 
     RowBox[{"permuation", " ", "order"}], ",", " ", 
     RowBox[{"squeezing", " ", "magnitude", " ", "r"}], ",", " ", 
     RowBox[{"phase", " ", "t"}]}], "*)"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"FTMS", "[", 
     RowBox[{"s_", ",", "ord_", ",", "r_", ",", "t_"}], "]"}], ":=", 
    RowBox[{
     RowBox[{"Inverse", "[", 
      RowBox[{"P", "[", "ord", "]"}], "]"}], ".", 
     RowBox[{"ArrayFlatten", "[", 
      RowBox[{"{", 
       RowBox[{
        RowBox[{"{", 
         RowBox[{
          RowBox[{"fTMS", "[", 
           RowBox[{"r", ",", "t"}], "]"}], ",", "0"}], "}"}], ",", 
        RowBox[{"{", 
         RowBox[{"0", ",", 
          RowBox[{"id", "[", 
           RowBox[{
            RowBox[{"Length", "[", "s", "]"}], "-", "4"}], "]"}]}], "}"}]}], 
       "}"}], "]"}], ".", 
     RowBox[{"P", "[", "ord", "]"}]}]}], "\[IndentingNewLine]", 
   "\[IndentingNewLine]", 
   RowBox[{"(*", 
    RowBox[{
    "performs", " ", "two", " ", "mode", " ", "squeezing", " ", 
     "transformation", " ", "of", " ", "s", " ", "and", " ", "v", " ", "on", 
     " ", "desired", " ", "modes", " ", "with", " ", "squeeze", " ", 
     "parameter", " ", 
     RowBox[{"re", "^", 
      RowBox[{"(", "it", ")"}]}]}], "*)"}], "\[IndentingNewLine]", 
   RowBox[{"(*", 
    RowBox[{
    "performed", " ", "on", " ", "the", " ", "first", " ", "two", " ", 
     "modes", " ", "of", " ", "ord"}], "*)"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"TMSs", "[", 
     RowBox[{"s_", ",", "ord_", ",", "r_", ",", "t_"}], "]"}], ":=", 
    RowBox[{
     RowBox[{"FTMS", "[", 
      RowBox[{"s", ",", "ord", ",", "r", ",", "t"}], "]"}], ".", "s", ".", 
     RowBox[{
      RowBox[{"FTMS", "[", 
       RowBox[{"s", ",", "ord", ",", "r", ",", "t"}], "]"}], 
      "\[Transpose]"}]}]}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"TMSv", "[", 
     RowBox[{"v_", ",", "ord_", ",", "r_", ",", "t_"}], "]"}], ":=", 
    RowBox[{
     RowBox[{"FTMS", "[", 
      RowBox[{"v", ",", "ord", ",", "r", ",", "t"}], "]"}], ".", "v"}]}], 
   "\[IndentingNewLine]", "\[IndentingNewLine]", "\[IndentingNewLine]", 
   "\[IndentingNewLine]", 
   RowBox[{"(*", 
    RowBox[{"BEAM", " ", "SPLITTER", " ", 
     RowBox[{"(", "BS", ")"}]}], "*)"}], "\[IndentingNewLine]", 
   "\[IndentingNewLine]", 
   RowBox[{"(*", 
    RowBox[{"f", " ", "for", " ", "BS"}], "*)"}], "\[IndentingNewLine]", 
   RowBox[{"(*", 
    RowBox[{"input", " ", "transmittivity", " ", "T"}], "*)"}], 
   "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"fBS", "[", "T_", "]"}], ":=", 
    RowBox[{"ArrayFlatten", "[", 
     RowBox[{"{", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{
         RowBox[{
          RowBox[{"Sqrt", "[", "T", "]"}], "*", 
          RowBox[{"id", "[", "2", "]"}]}], ",", 
         RowBox[{
          RowBox[{"Sqrt", "[", 
           RowBox[{"1", "-", "T"}], "]"}], "*", 
          RowBox[{"id", "[", "2", "]"}]}]}], "}"}], ",", 
       RowBox[{"{", 
        RowBox[{
         RowBox[{
          RowBox[{"-", 
           RowBox[{"Sqrt", "[", 
            RowBox[{"1", "-", "T"}], "]"}]}], "*", 
          RowBox[{"id", "[", "2", "]"}]}], ",", 
         RowBox[{
          RowBox[{"Sqrt", "[", "T", "]"}], "*", 
          RowBox[{"id", "[", "2", "]"}]}]}], "}"}]}], "}"}], "]"}]}], 
   "\[IndentingNewLine]", "\[IndentingNewLine]", 
   RowBox[{"(*", 
    RowBox[{"F", " ", "for", " ", "BS"}], "*)"}], "\[IndentingNewLine]", 
   RowBox[{"(*", 
    RowBox[{
    "input", " ", "order", " ", "and", " ", "trasnmitivity", " ", "T"}], 
    "*)"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"FBS", "[", 
     RowBox[{"s_", ",", "ord_", ",", "T_"}], "]"}], ":=", 
    RowBox[{
     RowBox[{"Inverse", "[", 
      RowBox[{"P", "[", "ord", "]"}], "]"}], ".", 
     RowBox[{"ArrayFlatten", "[", 
      RowBox[{"{", 
       RowBox[{
        RowBox[{"{", 
         RowBox[{
          RowBox[{"fBS", "[", "T", "]"}], ",", "0"}], "}"}], ",", 
        RowBox[{"{", 
         RowBox[{"0", ",", 
          RowBox[{"id", "[", 
           RowBox[{
            RowBox[{"Length", "[", "s", "]"}], "-", "4"}], "]"}]}], "}"}]}], 
       "}"}], "]"}], ".", 
     RowBox[{"P", "[", "ord", "]"}]}]}], "\[IndentingNewLine]", 
   "\[IndentingNewLine]", 
   RowBox[{"(*", 
    RowBox[{
    "functions", " ", "that", " ", "perform", " ", "regular", " ", "beam", 
     " ", "splitting", " ", "with", " ", "transmittivity", " ", "T", " ", 
     "in", " ", "the", " ", "first", " ", "mode", " ", "of", " ", "the", " ", 
     "ordering", " ", "ord"}], "*)"}], "\[IndentingNewLine]", 
   RowBox[{"(*", 
    RowBox[{
    "performed", " ", "on", " ", "the", " ", "first", " ", "two", " ", 
     "modes", " ", "of", " ", "ord"}], "*)"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"BSs", "[", 
     RowBox[{"s_", ",", "ord_", ",", "T_"}], "]"}], ":=", 
    RowBox[{
     RowBox[{"FBS", "[", 
      RowBox[{"s", ",", "ord", ",", "T"}], "]"}], ".", "s", ".", 
     RowBox[{
      RowBox[{"FBS", "[", 
       RowBox[{"s", ",", "ord", ",", "T"}], "]"}], "\[Transpose]"}]}]}], 
   "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"BSv", "[", 
     RowBox[{"v_", ",", "ord_", ",", "T_"}], "]"}], ":=", 
    RowBox[{
     RowBox[{"FBS", "[", 
      RowBox[{"v", ",", "ord", ",", "T"}], "]"}], ".", "v"}]}], 
   "\[IndentingNewLine]", "\[IndentingNewLine]", "\[IndentingNewLine]", 
   "\[IndentingNewLine]", 
   RowBox[{"(*", 
    RowBox[{"LOSS", " ", 
     RowBox[{"(", "L", ")"}]}], "*)"}], "\[IndentingNewLine]", 
   "\[IndentingNewLine]", 
   RowBox[{"(*", 
    RowBox[{
    "F", " ", "for", " ", "ficticious", " ", "beam", " ", "spliiter"}], 
    "*)"}], "\[IndentingNewLine]", 
   RowBox[{"(*", 
    RowBox[{
    "input", " ", "order", " ", "and", " ", "trasnmitivity", " ", "T"}], 
    "*)"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"FL", "[", 
     RowBox[{"s_", ",", "ord_", ",", "T_"}], "]"}], ":=", 
    RowBox[{
     RowBox[{"Inverse", "[", 
      RowBox[{"P", "[", "ord", "]"}], "]"}], ".", 
     RowBox[{"ArrayFlatten", "[", 
      RowBox[{"{", 
       RowBox[{
        RowBox[{"{", 
         RowBox[{
          RowBox[{"fBS", "[", "T", "]"}], ",", "0"}], "}"}], ",", 
        RowBox[{"{", 
         RowBox[{"0", ",", 
          RowBox[{"id", "[", 
           RowBox[{
            RowBox[{"Length", "[", "s", "]"}], "-", "2"}], "]"}]}], "}"}]}], 
       "}"}], "]"}], ".", 
     RowBox[{"P", "[", "ord", "]"}]}]}], "\[IndentingNewLine]", 
   "\[IndentingNewLine]", 
   RowBox[{"(*", 
    RowBox[{
     RowBox[{
     "functions", " ", "that", " ", "perform", " ", "loss", " ", "by", " ", 
      "adding", " ", "in", " ", "a", " ", "ficticious", " ", "mode"}], ",", 
     " ", 
     RowBox[{
     "putting", " ", "it", " ", "through", " ", "a", " ", "ficticious", " ", 
      "beam", " ", "splitter", " ", "with", " ", "the", " ", "lossy", " ", 
      "mode"}], ",", " ", 
     RowBox[{
     "and", " ", "then", " ", "cutting", " ", "out", " ", "the", " ", 
      "ficticious", " ", "mode"}]}], "*)"}], "\[IndentingNewLine]", 
   RowBox[{"(*", 
    RowBox[{
     RowBox[{"use", " ", "ord"}], "=", 
     RowBox[{
     "pmf", " ", "for", " ", "loss", " ", "in", " ", "mode", " ", "m"}]}], 
    "*)"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"Ls", "[", 
     RowBox[{"s_", ",", "ord_", ",", "T_"}], "]"}], ":=", 
    RowBox[{"(", 
     RowBox[{
      RowBox[{"sint", "=", 
       RowBox[{"ArrayFlatten", "[", 
        RowBox[{"{", 
         RowBox[{
          RowBox[{"{", 
           RowBox[{"s", ",", "0"}], "}"}], ",", 
          RowBox[{"{", 
           RowBox[{"0", ",", 
            RowBox[{
             RowBox[{"(", 
              RowBox[{"1", "/", "2"}], ")"}], "*", 
             RowBox[{"id", "[", "2", "]"}]}]}], "}"}]}], "}"}], "]"}]}], ";", 
      " ", 
      RowBox[{"sint2", "=", 
       RowBox[{
        RowBox[{"FL", "[", 
         RowBox[{"s", ",", "ord", ",", "T"}], "]"}], ".", "sint", ".", 
        RowBox[{
         RowBox[{"FL", "[", 
          RowBox[{"s", ",", "ord", ",", "T"}], "]"}], "\[Transpose]"}]}]}], 
      ";", " ", 
      RowBox[{"sint2", "[", 
       RowBox[{"[", 
        RowBox[{
         RowBox[{"1", ";;", 
          RowBox[{"Length", "[", "s", "]"}]}], ",", 
         RowBox[{"1", ";;", 
          RowBox[{"Length", "[", "s", "]"}]}]}], "]"}], "]"}]}], ")"}]}], 
   "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"Lv", "[", 
     RowBox[{"v_", ",", "ord_", ",", "T_"}], "]"}], ":=", 
    RowBox[{"(", 
     RowBox[{
      RowBox[{"vint", "=", 
       RowBox[{"Append", "[", 
        RowBox[{"v", ",", "0"}], "]"}]}], ";", 
      RowBox[{"vint2", "=", 
       RowBox[{"Append", "[", 
        RowBox[{"vint", ",", "0"}], "]"}]}], ";", " ", 
      RowBox[{"vint3", "=", 
       RowBox[{
        RowBox[{"FL", "[", 
         RowBox[{"v", ",", "ord", ",", "T"}], "]"}], ".", "vint2"}]}], ";", 
      " ", 
      RowBox[{"vint3", "[", 
       RowBox[{"[", 
        RowBox[{"1", ";;", 
         RowBox[{"Length", "[", "v", "]"}]}], "]"}], "]"}]}], ")"}]}], 
   "\[IndentingNewLine]", "\[IndentingNewLine]", "\[IndentingNewLine]", 
   "\[IndentingNewLine]", 
   RowBox[{"(*", 
    RowBox[{"PHASE", " ", "SHIFT", " ", 
     RowBox[{"(", "P", ")"}]}], "*)"}], "\[IndentingNewLine]", 
   "\[IndentingNewLine]", 
   RowBox[{"(*", 
    RowBox[{"f", " ", "for", " ", "P"}], "*)"}], "\[IndentingNewLine]", 
   RowBox[{"(*", 
    RowBox[{"input", " ", "phase", " ", "shift", " ", "phi"}], "*)"}], 
   "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"fP", "[", "phi_", "]"}], ":=", 
    RowBox[{"{", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{
        RowBox[{"Cos", "[", "phi", "]"}], ",", 
        RowBox[{"Sin", "[", "phi", "]"}]}], "}"}], ",", 
      RowBox[{"{", 
       RowBox[{
        RowBox[{"-", 
         RowBox[{"Sin", "[", "phi", "]"}]}], ",", 
        RowBox[{"Cos", "[", "phi", "]"}]}], "}"}]}], "}"}]}], 
   "\[IndentingNewLine]", "\[IndentingNewLine]", 
   RowBox[{"(*", 
    RowBox[{"F", " ", "for", " ", "P"}], "*)"}], "\[IndentingNewLine]", 
   RowBox[{"(*", 
    RowBox[{"input", " ", "phase", " ", "shift", " ", "phi"}], "*)"}], 
   "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"FP", "[", 
     RowBox[{"s_", ",", "ord_", ",", "phi_"}], "]"}], ":=", 
    RowBox[{
     RowBox[{"Inverse", "[", 
      RowBox[{"P", "[", "ord", "]"}], "]"}], ".", 
     RowBox[{"ArrayFlatten", "[", 
      RowBox[{"{", 
       RowBox[{
        RowBox[{"{", 
         RowBox[{
          RowBox[{"fP", "[", "phi", "]"}], ",", "0"}], "}"}], ",", 
        RowBox[{"{", 
         RowBox[{"0", ",", 
          RowBox[{"id", "[", 
           RowBox[{
            RowBox[{"Length", "[", "s", "]"}], "-", "2"}], "]"}]}], "}"}]}], 
       "}"}], "]"}], ".", 
     RowBox[{"P", "[", "ord", "]"}]}]}], "\[IndentingNewLine]", 
   "\[IndentingNewLine]", 
   RowBox[{"(*", 
    RowBox[{
    "functions", " ", "that", " ", "perform", " ", "phase", " ", "shifting", 
     " ", "by", " ", "phi", " ", "in", " ", "the", " ", "first", " ", "mode", 
     " ", "of", " ", "ord"}], "*)"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"Ps", "[", 
     RowBox[{"s_", ",", "ord_", ",", "phi_"}], "]"}], ":=", 
    RowBox[{
     RowBox[{"FP", "[", 
      RowBox[{"s", ",", "ord", ",", "phi"}], "]"}], ".", "s", ".", 
     RowBox[{
      RowBox[{"FP", "[", 
       RowBox[{"s", ",", "ord", ",", "phi"}], "]"}], "\[Transpose]"}]}]}], 
   "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"Pv", "[", 
     RowBox[{"v_", ",", "ord_", ",", "phi_"}], "]"}], ":=", 
    RowBox[{
     RowBox[{"FP", "[", 
      RowBox[{"v", ",", "ord", ",", "phi"}], "]"}], ".", "v"}]}], 
   "\[IndentingNewLine]", "\[IndentingNewLine]", "\[IndentingNewLine]", 
   RowBox[{"(*", 
    RowBox[{
     RowBox[{
     "new", " ", "functions", " ", "could", " ", "be", " ", "defined", " ", 
      "to", " ", "perform", " ", "other", " ", "operations"}], ",", " ", 
     RowBox[{
     "so", " ", "long", " ", "as", " ", "they", " ", "are", " ", 
      "Gaussian"}]}], "*)"}], "\[IndentingNewLine]", "\[IndentingNewLine]", 
   "\[IndentingNewLine]", "\[IndentingNewLine]", 
   RowBox[{"(*", 
    RowBox[{
     RowBox[{
     "here", " ", "we", " ", "define", " ", "functions", " ", "that", " ", 
      "take", " ", "in", " ", "an", " ", "initaial", " ", "s", " ", "and", 
      " ", "v"}], ",", " ", 
     RowBox[{
     "then", " ", "output", " ", "the", " ", "s", " ", "and", " ", "v", " ", 
      "after", " ", "certain", " ", "Gaussian", " ", "transformations"}]}], 
    "*)"}], "\[IndentingNewLine]", 
   RowBox[{"(*", 
    RowBox[{
     RowBox[{
     "the", " ", "output", " ", "is", " ", "written", " ", "in", " ", 
      RowBox[{"Safranek", "'"}], "s", " ", "real", " ", "formalism"}], ",", 
     " ", 
     RowBox[{
     "which", " ", "is", " ", "not", " ", "the", " ", "same", " ", "as", " ", 
      
      RowBox[{"Brask", "'"}], "s"}]}], "*)"}], "\[IndentingNewLine]", 
   RowBox[{"(*", 
    RowBox[{
     RowBox[{
     "to", " ", "account", " ", "for", " ", "the", " ", "differences", " ", 
      "between", " ", "the", " ", "Brask", " ", "and", " ", "Safrenek", " ", 
      "formalisms"}], ",", " ", 
     RowBox[{
     "the", " ", "basis", " ", "of", " ", "s", " ", "and", " ", "v", " ", 
      "must", " ", "be", " ", "reordered", " ", "from", " ", "the", " ", 
      "quadratures", " ", "x1"}], ",", "p1", ",", "x2", ",", "p2", ",", 
     RowBox[{"...", " ", "to", " ", "x1"}], ",", "x2", ",", "...", ",", "p1", 
     ",", "p2", ",", 
     RowBox[{
     "...", " ", "and", " ", "s", " ", "must", " ", "be", " ", "multipled", 
      " ", "by", " ", "2"}]}], "*)"}], "\[IndentingNewLine]", 
   "\[IndentingNewLine]", "\[IndentingNewLine]", 
   RowBox[{"(*", 
    RowBox[{
    "Yurke", " ", "interferometer", " ", "with", " ", "no", " ", "external", 
     " ", "loss"}], "*)"}], "\[IndentingNewLine]", 
   RowBox[{"(*", 
    RowBox[{
    "note", " ", "that", " ", "this", " ", "has", " ", "the", " ", "same", 
     " ", "QFI", " ", "as", " ", "the", " ", "Mandel", " ", "interferometer", 
     " ", "with", " ", "no", " ", "external", " ", "loss"}], "*)"}], 
   "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"YMI", "[", 
     RowBox[{"s_", ",", "v_", ",", "r1_", ",", "t1_", ",", "T_"}], "]"}], ":=", 
    RowBox[{"(", 
     RowBox[{
      RowBox[{"phi", "=."}], ";", "\[IndentingNewLine]", 
      RowBox[{"s1", "=", 
       RowBox[{"TMSs", "[", 
        RowBox[{"s", ",", "pab", ",", "r1", ",", "t1"}], "]"}]}], ";", " ", 
      RowBox[{"v1", "=", 
       RowBox[{"TMSv", "[", 
        RowBox[{"v", ",", "pab", ",", "r1", ",", "t1"}], "]"}]}], ";", " ", 
      "\[IndentingNewLine]", 
      RowBox[{"s2", "=", 
       RowBox[{"Ls", "[", 
        RowBox[{"s1", ",", "paf", ",", "T"}], "]"}]}], ";", 
      RowBox[{"v2", "=", 
       RowBox[{"Lv", "[", 
        RowBox[{"v1", ",", "paf", ",", "T"}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"s3", "=", 
       RowBox[{"Ls", "[", 
        RowBox[{"s2", ",", "pbf", ",", "T"}], "]"}]}], ";", 
      RowBox[{"v3", "=", 
       RowBox[{"Lv", "[", 
        RowBox[{"v2", ",", "pbf", ",", "T"}], "]"}]}], ";", " ", 
      "\[IndentingNewLine]", 
      RowBox[{"s4", "=", 
       RowBox[{"Ps", "[", 
        RowBox[{"s3", ",", "pa", ",", "phi"}], "]"}]}], ";", 
      RowBox[{"v4", "=", 
       RowBox[{"Pv", "[", 
        RowBox[{"v3", ",", "pa", ",", "phi"}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"s8", "=", 
       RowBox[{"s4", "[", 
        RowBox[{"[", 
         RowBox[{
          RowBox[{"1", ";;", "4"}], ",", 
          RowBox[{"1", ";;", "4"}]}], "]"}], "]"}]}], ";", 
      RowBox[{"v8", "=", 
       RowBox[{"v4", "[", 
        RowBox[{"[", 
         RowBox[{"1", ";;", "4"}], "]"}], "]"}]}], ";", "  ", 
      "\[IndentingNewLine]", 
      RowBox[{"Pord", "=", 
       RowBox[{"P", "[", 
        RowBox[{"{", 
         RowBox[{"1", ",", "3", ",", "2", ",", "4"}], "}"}], "]"}]}], ";", 
      " ", "\[IndentingNewLine]", 
      RowBox[{"s9", "=", 
       RowBox[{"2", "*", 
        RowBox[{"Pord", ".", "s8", ".", 
         RowBox[{"Pord", "\[Transpose]"}]}]}]}], ";", " ", 
      RowBox[{"v9", "=", 
       RowBox[{"Pord", ".", "v8"}]}], ";", " ", "\[IndentingNewLine]", 
      RowBox[{"{", 
       RowBox[{
        RowBox[{"FullSimplify", "[", "s9", "]"}], ",", 
        RowBox[{"FullSimplify", "[", "v9", "]"}]}], "}"}]}], ")"}]}], 
   "\[IndentingNewLine]", "\[IndentingNewLine]", "\[IndentingNewLine]", 
   RowBox[{"(*", 
    RowBox[{
    "Yurke", " ", "with", " ", "both", " ", "types", " ", "of", " ", "loss"}],
     "*)"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"Yurke", "[", 
     RowBox[{
     "s_", ",", "v_", ",", "r1_", ",", "t1_", ",", "r2_", ",", "t2_", ",", 
      "T_", ",", "n_"}], "]"}], ":=", 
    RowBox[{"(", 
     RowBox[{
      RowBox[{"phi", "=."}], ";", "\[IndentingNewLine]", 
      RowBox[{"s1", "=", 
       RowBox[{"TMSs", "[", 
        RowBox[{"s", ",", "pab", ",", "r1", ",", "t1"}], "]"}]}], ";", " ", 
      RowBox[{"v1", "=", 
       RowBox[{"TMSv", "[", 
        RowBox[{"v", ",", "pab", ",", "r1", ",", "t1"}], "]"}]}], ";", " ", 
      "\[IndentingNewLine]", 
      RowBox[{"s2", "=", 
       RowBox[{"Ls", "[", 
        RowBox[{"s1", ",", "paf", ",", "T"}], "]"}]}], ";", 
      RowBox[{"v2", "=", 
       RowBox[{"Lv", "[", 
        RowBox[{"v1", ",", "paf", ",", "T"}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"s3", "=", 
       RowBox[{"Ls", "[", 
        RowBox[{"s2", ",", "pbf", ",", "T"}], "]"}]}], ";", 
      RowBox[{"v3", "=", 
       RowBox[{"Lv", "[", 
        RowBox[{"v2", ",", "pbf", ",", "T"}], "]"}]}], ";", " ", 
      "\[IndentingNewLine]", 
      RowBox[{"s4", "=", 
       RowBox[{"Ps", "[", 
        RowBox[{"s3", ",", "pa", ",", "phi"}], "]"}]}], ";", 
      RowBox[{"v4", "=", 
       RowBox[{"Pv", "[", 
        RowBox[{"v3", ",", "pa", ",", "phi"}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"s5", "=", 
       RowBox[{"TMSs", "[", 
        RowBox[{"s4", ",", "pab", ",", "r2", ",", "t2"}], "]"}]}], ";", " ", 
      RowBox[{"v5", "=", 
       RowBox[{"TMSv", "[", 
        RowBox[{"v4", ",", "pab", ",", "r2", ",", "t2"}], "]"}]}], ";", " ", 
      "\[IndentingNewLine]", 
      RowBox[{"s6", "=", 
       RowBox[{"Ls", "[", 
        RowBox[{"s5", ",", "paf", ",", "n"}], "]"}]}], ";", 
      RowBox[{"v6", "=", 
       RowBox[{"Lv", "[", 
        RowBox[{"v5", ",", "paf", ",", "n"}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"s7", "=", 
       RowBox[{"Ls", "[", 
        RowBox[{"s6", ",", "pbf", ",", "n"}], "]"}]}], ";", 
      RowBox[{"v7", "=", 
       RowBox[{"Lv", "[", 
        RowBox[{"v6", ",", "pbf", ",", "n"}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"s8", "=", 
       RowBox[{"s7", "[", 
        RowBox[{"[", 
         RowBox[{
          RowBox[{"1", ";;", "4"}], ",", 
          RowBox[{"1", ";;", "4"}]}], "]"}], "]"}]}], ";", 
      RowBox[{"v8", "=", 
       RowBox[{"v7", "[", 
        RowBox[{"[", 
         RowBox[{"1", ";;", "4"}], "]"}], "]"}]}], ";", "  ", 
      "\[IndentingNewLine]", 
      RowBox[{"Pord", "=", 
       RowBox[{"P", "[", 
        RowBox[{"{", 
         RowBox[{"1", ",", "3", ",", "2", ",", "4"}], "}"}], "]"}]}], ";", 
      " ", "\[IndentingNewLine]", 
      RowBox[{"s9", "=", 
       RowBox[{"2", "*", 
        RowBox[{"Pord", ".", "s8", ".", 
         RowBox[{"Pord", "\[Transpose]"}]}]}]}], ";", " ", 
      RowBox[{"v9", "=", 
       RowBox[{"Pord", ".", "v8"}]}], ";", " ", "\[IndentingNewLine]", 
      RowBox[{"{", 
       RowBox[{
        RowBox[{"FullSimplify", "[", "s9", "]"}], ",", 
        RowBox[{"FullSimplify", "[", "v9", "]"}]}], "}"}]}], ")"}]}], 
   "\[IndentingNewLine]", "\[IndentingNewLine]", "\[IndentingNewLine]", 
   RowBox[{"(*", 
    RowBox[{
    "Mandel", " ", "interferometer", " ", "with", " ", "both", " ", 
     "internal", " ", "and", " ", "external", " ", "loss"}], "*)"}], 
   "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"Mandel", "[", 
     RowBox[{
     "s_", ",", "v_", ",", "r1_", ",", "t1_", ",", "r2_", ",", "t2_", ",", 
      "T_", ",", "n_"}], "]"}], ":=", 
    RowBox[{"(", 
     RowBox[{
      RowBox[{"phi", "=."}], ";", "\[IndentingNewLine]", 
      RowBox[{"s1", "=", 
       RowBox[{"TMSs", "[", 
        RowBox[{"s", ",", "pab", ",", "r1", ",", "t1"}], "]"}]}], ";", " ", 
      RowBox[{"v1", "=", 
       RowBox[{"TMSv", "[", 
        RowBox[{"v", ",", "pab", ",", "r1", ",", "t1"}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"s2", "=", 
       RowBox[{"Ls", "[", 
        RowBox[{"s1", ",", "paf", ",", "T"}], "]"}]}], ";", " ", 
      RowBox[{"v2", "=", 
       RowBox[{"Lv", "[", 
        RowBox[{"v1", ",", "paf", ",", "T"}], "]"}]}], ";", " ", 
      "\[IndentingNewLine]", 
      RowBox[{"s3", "=", 
       RowBox[{"Ls", "[", 
        RowBox[{"s2", ",", "pbf", ",", "T"}], "]"}]}], ";", " ", 
      RowBox[{"v3", "=", 
       RowBox[{"Lv", "[", 
        RowBox[{"v2", ",", "pbf", ",", "T"}], "]"}]}], ";", " ", 
      "\[IndentingNewLine]", 
      RowBox[{"s4", "=", 
       RowBox[{"Ps", "[", 
        RowBox[{"s3", ",", "pa", ",", "phi"}], "]"}]}], ";", 
      RowBox[{"v4", "=", 
       RowBox[{"Pv", "[", 
        RowBox[{"v3", ",", "pa", ",", "phi"}], "]"}]}], ";", " ", 
      "\[IndentingNewLine]", 
      RowBox[{"s5", "=", 
       RowBox[{"TMSs", "[", 
        RowBox[{"s4", ",", "pac", ",", "r2", ",", "t2"}], "]"}]}], ";", " ", 
      RowBox[{"v5", "=", 
       RowBox[{"TMSv", "[", 
        RowBox[{"v4", ",", "pac", ",", "r2", ",", "t2"}], "]"}]}], ";", 
      RowBox[{"s6", "=", 
       RowBox[{"Ls", "[", 
        RowBox[{"s5", ",", "paf", ",", "n"}], "]"}]}], ";", " ", 
      RowBox[{"v6", "=", 
       RowBox[{"Lv", "[", 
        RowBox[{"v5", ",", "paf", ",", "n"}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"s8", "=", 
       RowBox[{"BSs", "[", 
        RowBox[{"s6", ",", "pbc", ",", 
         RowBox[{"1", "/", "2"}]}], "]"}]}], ";", " ", 
      RowBox[{"v8", "=", 
       RowBox[{"BSv", "[", 
        RowBox[{"v6", ",", "pbc", ",", 
         RowBox[{"1", "/", "2"}]}], "]"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"s9", "=", 
       RowBox[{"Ls", "[", 
        RowBox[{"s8", ",", "pbf", ",", "n"}], "]"}]}], ";", " ", 
      RowBox[{"v9", "=", 
       RowBox[{"Lv", "[", 
        RowBox[{"v8", ",", "pbf", ",", "n"}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"s10", "=", 
       RowBox[{"Ls", "[", 
        RowBox[{"s9", ",", "pcf", ",", "n"}], "]"}]}], ";", 
      RowBox[{"v10", "=", 
       RowBox[{"Lv", "[", 
        RowBox[{"v9", ",", "pcf", ",", "n"}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"Pord", "=", 
       RowBox[{"P", "[", 
        RowBox[{"{", 
         RowBox[{"1", ",", "3", ",", "5", ",", "2", ",", "4", ",", "6"}], 
         "}"}], "]"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"s11", "=", 
       RowBox[{"2", "*", 
        RowBox[{"Pord", ".", "s10", ".", 
         RowBox[{"Pord", "\[Transpose]"}]}]}]}], ";", 
      RowBox[{"v11", "=", 
       RowBox[{"Pord", ".", "v10"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"{", 
       RowBox[{
        RowBox[{"FullSimplify", "[", "s11", "]"}], ",", 
        RowBox[{"FullSimplify", "[", "v11", "]"}]}], "}"}]}], ")"}]}], 
   "\[IndentingNewLine]", "\[IndentingNewLine]", "\[IndentingNewLine]", 
   RowBox[{"(*", 
    RowBox[{
    "Mandel", " ", "with", " ", "mode", " ", "a", " ", "cut", " ", "out", " ",
      "at", " ", "the", " ", "end"}], "*)"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"Mandelnoa", "[", 
     RowBox[{
     "s_", ",", "v_", ",", "r1_", ",", "t1_", ",", "r2_", ",", "t2_", ",", 
      "T_", ",", "n_"}], "]"}], ":=", 
    RowBox[{"(", 
     RowBox[{
      RowBox[{"phi", "=."}], ";", "\[IndentingNewLine]", 
      RowBox[{"s1", "=", 
       RowBox[{"TMSs", "[", 
        RowBox[{"s", ",", "pab", ",", "r1", ",", "t1"}], "]"}]}], ";", " ", 
      RowBox[{"v1", "=", 
       RowBox[{"TMSv", "[", 
        RowBox[{"v", ",", "pab", ",", "r1", ",", "t1"}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"s2", "=", 
       RowBox[{"Ls", "[", 
        RowBox[{"s1", ",", "paf", ",", "T"}], "]"}]}], ";", " ", 
      RowBox[{"v2", "=", 
       RowBox[{"Lv", "[", 
        RowBox[{"v1", ",", "paf", ",", "T"}], "]"}]}], ";", " ", 
      "\[IndentingNewLine]", 
      RowBox[{"s3", "=", 
       RowBox[{"Ls", "[", 
        RowBox[{"s2", ",", "pbf", ",", "T"}], "]"}]}], ";", " ", 
      RowBox[{"v3", "=", 
       RowBox[{"Lv", "[", 
        RowBox[{"v2", ",", "pbf", ",", "T"}], "]"}]}], ";", " ", 
      "\[IndentingNewLine]", 
      RowBox[{"s4", "=", 
       RowBox[{"Ps", "[", 
        RowBox[{"s3", ",", "pa", ",", "phi"}], "]"}]}], ";", 
      RowBox[{"v4", "=", 
       RowBox[{"Pv", "[", 
        RowBox[{"v3", ",", "pa", ",", "phi"}], "]"}]}], ";", " ", 
      "\[IndentingNewLine]", 
      RowBox[{"s5", "=", 
       RowBox[{"TMSs", "[", 
        RowBox[{"s4", ",", "pac", ",", "r2", ",", "t2"}], "]"}]}], ";", " ", 
      RowBox[{"v5", "=", 
       RowBox[{"TMSv", "[", 
        RowBox[{"v4", ",", "pac", ",", "r2", ",", "t2"}], "]"}]}], ";", 
      RowBox[{"s6", "=", 
       RowBox[{"Ls", "[", 
        RowBox[{"s5", ",", "paf", ",", "n"}], "]"}]}], ";", " ", 
      RowBox[{"v6", "=", 
       RowBox[{"Lv", "[", 
        RowBox[{"v5", ",", "paf", ",", "n"}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"s8", "=", 
       RowBox[{"BSs", "[", 
        RowBox[{"s6", ",", "pbc", ",", 
         RowBox[{"1", "/", "2"}]}], "]"}]}], ";", " ", 
      RowBox[{"v8", "=", 
       RowBox[{"BSv", "[", 
        RowBox[{"v6", ",", "pbc", ",", 
         RowBox[{"1", "/", "2"}]}], "]"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"s9", "=", 
       RowBox[{"Ls", "[", 
        RowBox[{"s8", ",", "pbf", ",", "n"}], "]"}]}], ";", " ", 
      RowBox[{"v9", "=", 
       RowBox[{"Lv", "[", 
        RowBox[{"v8", ",", "pbf", ",", "n"}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"s10", "=", 
       RowBox[{"Ls", "[", 
        RowBox[{"s9", ",", "pcf", ",", "n"}], "]"}]}], ";", 
      RowBox[{"v10", "=", 
       RowBox[{"Lv", "[", 
        RowBox[{"v9", ",", "pcf", ",", "n"}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"s11", "=", 
       RowBox[{"s10", "[", 
        RowBox[{"[", 
         RowBox[{
          RowBox[{"3", ";;", "6"}], ",", 
          RowBox[{"3", ";;", "6"}]}], "]"}], "]"}]}], ";", " ", 
      RowBox[{"v11", "=", 
       RowBox[{"v10", "[", 
        RowBox[{"[", 
         RowBox[{"3", ";;", "6"}], "]"}], "]"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"Pord", "=", 
       RowBox[{"P", "[", 
        RowBox[{"{", 
         RowBox[{"1", ",", "3", ",", "2", ",", "4"}], "}"}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"s12", "=", 
       RowBox[{"2", "*", 
        RowBox[{"Pord", ".", "s11", ".", 
         RowBox[{"Pord", "\[Transpose]"}]}]}]}], ";", 
      RowBox[{"v12", "=", 
       RowBox[{"Pord", ".", "v11"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"{", 
       RowBox[{
        RowBox[{"FullSimplify", "[", "s12", "]"}], ",", 
        RowBox[{"FullSimplify", "[", "v12", "]"}]}], "}"}]}], ")"}]}], 
   "\[IndentingNewLine]", "\[IndentingNewLine]", "\[IndentingNewLine]", 
   RowBox[{"(*", 
    RowBox[{"Mach", "-", 
     RowBox[{"Zehnder", " ", "Interferometer"}]}], "*)"}], 
   "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"MZI", "[", 
     RowBox[{"s_", ",", "v_", ",", "T_", ",", "n_"}], "]"}], ":=", 
    RowBox[{"(", 
     RowBox[{
      RowBox[{"phi", "=."}], ";", "\[IndentingNewLine]", 
      RowBox[{"s1", "=", 
       RowBox[{"BSs", "[", 
        RowBox[{"s", ",", "pab", ",", 
         RowBox[{"1", "/", "2"}]}], "]"}]}], ";", " ", 
      RowBox[{"v1", "=", 
       RowBox[{"BSv", "[", 
        RowBox[{"v", ",", "pab", ",", 
         RowBox[{"1", "/", "2"}]}], "]"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"s2", "=", 
       RowBox[{"Ls", "[", 
        RowBox[{"s1", ",", "paf", ",", "T"}], "]"}]}], ";", " ", 
      RowBox[{"v2", "=", 
       RowBox[{"Lv", "[", 
        RowBox[{"v1", ",", "paf", ",", "T"}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"s3", "=", 
       RowBox[{"Ls", "[", 
        RowBox[{"s2", ",", "pbf", ",", "T"}], "]"}]}], ";", " ", 
      RowBox[{"v3", "=", 
       RowBox[{"Lv", "[", 
        RowBox[{"v2", ",", "pbf", ",", "T"}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"s4", "=", 
       RowBox[{"Ps", "[", 
        RowBox[{"s3", ",", "pa", ",", "phi"}], "]"}]}], ";", 
      RowBox[{"v4", "=", 
       RowBox[{"Pv", "[", 
        RowBox[{"v3", ",", "pa", ",", "phi"}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"s5", "=", 
       RowBox[{"BSs", "[", 
        RowBox[{"s4", ",", "pab", ",", 
         RowBox[{"1", "/", "2"}]}], "]"}]}], ";", " ", 
      RowBox[{"v5", "=", 
       RowBox[{"BSv", "[", 
        RowBox[{"v4", ",", "pab", ",", 
         RowBox[{"1", "/", "2"}]}], "]"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"s6", "=", 
       RowBox[{"Ls", "[", 
        RowBox[{"s5", ",", "paf", ",", "n"}], "]"}]}], ";", " ", 
      RowBox[{"v6", "=", 
       RowBox[{"Lv", "[", 
        RowBox[{"v5", ",", "paf", ",", "n"}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"s7", "=", 
       RowBox[{"Ls", "[", 
        RowBox[{"s6", ",", "pbf", ",", "n"}], "]"}]}], ";", " ", 
      RowBox[{"v7", "=", 
       RowBox[{"Lv", "[", 
        RowBox[{"v6", ",", "pbf", ",", "n"}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"s8", "=", 
       RowBox[{"s7", "[", 
        RowBox[{"[", 
         RowBox[{
          RowBox[{"1", ";;", "4"}], ",", 
          RowBox[{"1", ";;", "4"}]}], "]"}], "]"}]}], ";", 
      RowBox[{"v8", "=", 
       RowBox[{"v7", "[", 
        RowBox[{"[", 
         RowBox[{"1", ";;", "4"}], "]"}], "]"}]}], ";", "  ", 
      "\[IndentingNewLine]", 
      RowBox[{"Pord", "=", 
       RowBox[{"P", "[", 
        RowBox[{"{", 
         RowBox[{"1", ",", "3", ",", "2", ",", "4"}], "}"}], "]"}]}], ";", 
      " ", "\[IndentingNewLine]", 
      RowBox[{"s9", "=", 
       RowBox[{"2", "*", 
        RowBox[{"Pord", ".", "s8", ".", 
         RowBox[{"Pord", "\[Transpose]"}]}]}]}], ";", " ", 
      RowBox[{"v9", "=", 
       RowBox[{"Pord", ".", "v8"}]}], ";", " ", "\[IndentingNewLine]", 
      RowBox[{"{", 
       RowBox[{
        RowBox[{"FullSimplify", "[", "s9", "]"}], ",", 
        RowBox[{"FullSimplify", "[", "v9", "]"}]}], "}"}]}], ")"}]}], 
   "\[IndentingNewLine]", "\[IndentingNewLine]", "\[IndentingNewLine]", 
   "\[IndentingNewLine]", 
   RowBox[{"(*", 
    RowBox[{
    "now", " ", "we", " ", "move", " ", "on", " ", "to", " ", "functions", 
     " ", "which", " ", "compute", " ", "the", " ", "QFI", " ", "from", " ", 
     "the", " ", "Gaussian", " ", "state"}], "*)"}], "\[IndentingNewLine]", 
   RowBox[{"(*", 
    RowBox[{
     RowBox[{
     "this", " ", "follows", " ", "the", " ", "results", " ", "from", " ", 
      RowBox[{"Safranek", ":", " ", "https", ":"}]}], "//", 
     RowBox[{
      RowBox[{
       RowBox[{
        RowBox[{
         RowBox[{"iopscience", ".", "iop", ".", "org"}], "/", "article"}], 
        "/", "10.1088"}], "/", "1751"}], "-", 
      RowBox[{
       RowBox[{"8121", "/", "aaf068"}], "/", 
       RowBox[{"pdf", "."}]}]}]}], "*)"}], "\[IndentingNewLine]", 
   "\[IndentingNewLine]", "\[IndentingNewLine]", 
   RowBox[{"(*", 
    RowBox[{"finds", " ", "QFI", " ", "for", " ", "pure", " ", "state"}], 
    "*)"}], "\[IndentingNewLine]", 
   RowBox[{"(*", 
    RowBox[{
     RowBox[{
     "this", " ", "is", " ", "done", " ", "using", " ", "the", " ", "real", 
      " ", "formalism"}], ",", " ", 
     RowBox[{
     "which", " ", "is", " ", "what", " ", "the", " ", "interferometer", " ", 
      "functions", " ", "in", " ", "the", " ", "previous", " ", "section", 
      " ", "output"}]}], "*)"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"PureIQ", "[", 
     RowBox[{"s_", ",", "v_", ",", "phival_"}], "]"}], ":=", 
    RowBox[{"(", 
     RowBox[{
      RowBox[{"ds", "=", 
       RowBox[{"D", "[", 
        RowBox[{"s", ",", "phi"}], "]"}]}], ";", 
      RowBox[{"dv", "=", 
       RowBox[{"D", "[", 
        RowBox[{"v", ",", "phi"}], "]"}]}], ";", 
      RowBox[{"phi", "=", "phival"}], ";", "\[IndentingNewLine]", 
      RowBox[{"sinv", "=", 
       RowBox[{"Simplify", "[", 
        RowBox[{"Inverse", "[", "s", "]"}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"Simplify", "[", 
       RowBox[{
        RowBox[{
         RowBox[{"(", 
          RowBox[{"1", "/", "4"}], ")"}], "*", 
         RowBox[{"Tr", "[", 
          RowBox[{"sinv", ".", "ds", ".", "sinv", ".", "ds"}], "]"}]}], "+", 
        RowBox[{"2", 
         RowBox[{"dv", ".", "sinv", ".", "dv"}]}]}], "]"}]}], ")"}]}], 
   "\[IndentingNewLine]", "\[IndentingNewLine]", "\[IndentingNewLine]", 
   RowBox[{"(*", 
    RowBox[{
     RowBox[{
     "next", " ", "we", " ", "have", " ", "functions", " ", "that", " ", 
      "compute", " ", "the", " ", "QFI", " ", "of", " ", "a", " ", "mixed", 
      " ", "state"}], ",", " ", 
     RowBox[{
     "but", " ", "these", " ", "use", " ", "the", " ", "complex", " ", 
      "formalism"}]}], "*)"}], "\[IndentingNewLine]", "\[IndentingNewLine]", 
   RowBox[{"(*", 
    RowBox[{
    "Unitary", " ", "to", " ", "convert", " ", "from", " ", "real", " ", 
     "formalism", " ", "to", " ", "the", " ", "complex", " ", "formalism"}], 
    "*)"}], "\[IndentingNewLine]", 
   RowBox[{"(*", 
    RowBox[{
    "the", " ", "examples", " ", "at", " ", "the", " ", "end", " ", "will", 
     " ", "show", " ", "how", " ", "to", " ", "use", " ", "this"}], "*)"}], 
   "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"U", "[", "s_", "]"}], ":=", 
    RowBox[{"(", 
     RowBox[{
      RowBox[{"num", "=", 
       RowBox[{
        RowBox[{"Length", "[", "s", "]"}], "/", "2"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"(", 
        RowBox[{"1", "/", 
         RowBox[{"Sqrt", "[", "2", "]"}]}], ")"}], "*", 
       RowBox[{"ArrayFlatten", "[", 
        RowBox[{"{", 
         RowBox[{
          RowBox[{"{", 
           RowBox[{
            RowBox[{"id", "[", "num", "]"}], ",", 
            RowBox[{"\[ImaginaryI]", "*", 
             RowBox[{"id", "[", "num", "]"}]}]}], "}"}], ",", 
          RowBox[{"{", 
           RowBox[{
            RowBox[{"id", "[", "num", "]"}], ",", 
            RowBox[{
             RowBox[{"-", "\[ImaginaryI]"}], "*", 
             RowBox[{"id", "[", "num", "]"}]}]}], "}"}]}], "}"}], "]"}]}]}], 
     ")"}]}], "\[IndentingNewLine]", "\[IndentingNewLine]", 
   RowBox[{"(*", 
    RowBox[{"vectorizes", " ", "a", " ", "matrix", " ", "m"}], "*)"}], 
   "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"Vec", "[", "m_", "]"}], ":=", 
    RowBox[{"ArrayReshape", "[", 
     RowBox[{
      RowBox[{"Transpose", "[", "m", "]"}], ",", 
      RowBox[{"{", 
       RowBox[{
        RowBox[{"Times", "@@", 
         RowBox[{"Dimensions", "[", "m", "]"}]}], ",", "1"}], "}"}]}], 
     "]"}]}], "\[IndentingNewLine]", "\[IndentingNewLine]", 
   RowBox[{"(*", 
    RowBox[{
    "symplectic", " ", "matrix", " ", "K", " ", "for", " ", "the", " ", 
     "complex", " ", "formalism"}], "*)"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"Kmat", "[", "s_", "]"}], ":=", 
    RowBox[{"(", 
     RowBox[{
      RowBox[{"num", "=", 
       RowBox[{
        RowBox[{"Length", "[", "s", "]"}], "/", "2"}]}], ";", 
      RowBox[{"ArrayFlatten", "[", 
       RowBox[{"{", 
        RowBox[{
         RowBox[{"{", 
          RowBox[{
           RowBox[{"id", "[", "num", "]"}], ",", "0"}], "}"}], ",", 
         RowBox[{"{", 
          RowBox[{"0", ",", 
           RowBox[{"-", 
            RowBox[{"id", "[", "num", "]"}]}]}], "}"}]}], "}"}], "]"}]}], 
     ")"}]}], "\[IndentingNewLine]", "\[IndentingNewLine]", 
   "\[IndentingNewLine]", 
   RowBox[{"(*", 
    RowBox[{
    "QFI", " ", "of", " ", "mixed", " ", "state", " ", "from", " ", "complex",
      " ", "formalism"}], "*)"}], "\[IndentingNewLine]", 
   RowBox[{"(*", 
    RowBox[{
     RowBox[{"must", " ", "have", " ", "s"}], ",", 
     RowBox[{"v", " ", "as", " ", "complex", " ", "already"}]}], "*)"}], 
   "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"CIQ", "[", 
     RowBox[{"s_", ",", "v_"}], "]"}], ":=", 
    RowBox[{"(", "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"K", "=", 
       RowBox[{"Kmat", "[", "s", "]"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"ds", "=", 
       RowBox[{"FullSimplify", "[", 
        RowBox[{"D", "[", 
         RowBox[{"s", ",", "phi"}], "]"}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"dv", "=", 
       RowBox[{"FullSimplify", "[", 
        RowBox[{"D", "[", 
         RowBox[{"v", ",", "phi"}], "]"}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"sK", "=", 
       RowBox[{"FullSimplify", "[", 
        RowBox[{"s", ".", "K"}], "]"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"Eigstuff", "=", 
       RowBox[{"Eigensystem", "[", "sK", "]"}]}], ";", "\[IndentingNewLine]", 
      
      RowBox[{"evals", "=", 
       RowBox[{"FullSimplify", "[", 
        RowBox[{"Eigstuff", "[", 
         RowBox[{"[", "1", "]"}], "]"}], "]"}]}], ";", "\[IndentingNewLine]", 
      
      RowBox[{"evecs", "=", 
       RowBox[{"FullSimplify", "[", 
        RowBox[{"Eigstuff", "[", 
         RowBox[{"[", "2", "]"}], "]"}], "]"}]}], ";", "\[IndentingNewLine]", 
      
      RowBox[{"l", "=", 
       RowBox[{"DiagonalMatrix", "[", "evals", "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"q", "=", 
       RowBox[{"Transpose", "[", "evecs", "]"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"qinv", "=", 
       RowBox[{"FullSimplify", "[", 
        RowBox[{"Inverse", "[", "q", "]"}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"Sig", "=", 
       RowBox[{"FullSimplify", "[", 
        RowBox[{"qinv", ".", "ds", ".", "K", ".", "q"}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"Dinv", "=", 
       RowBox[{"FullSimplify", "[", 
        RowBox[{"Inverse", "[", 
         RowBox[{
          RowBox[{"KroneckerProduct", "[", 
           RowBox[{"l", ",", "l"}], "]"}], "-", 
          RowBox[{"id", "[", 
           RowBox[{
            RowBox[{"(", 
             RowBox[{"Length", "[", "s", "]"}], ")"}], "^", "2"}], "]"}]}], 
         "]"}], "]"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"Kt", "=", 
       RowBox[{"ArrayFlatten", "[", 
        RowBox[{"{", 
         RowBox[{
          RowBox[{"{", 
           RowBox[{"0", ",", 
            RowBox[{"-", 
             RowBox[{"id", "[", 
              RowBox[{
               RowBox[{"Length", "[", "s", "]"}], "/", "2"}], "]"}]}]}], 
           "}"}], ",", 
          RowBox[{"{", 
           RowBox[{
            RowBox[{"id", "[", 
             RowBox[{
              RowBox[{"Length", "[", "s", "]"}], "/", "2"}], "]"}], ",", 
            "0"}], "}"}]}], "}"}], "]"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"FullSimplify", "[", 
       RowBox[{
        RowBox[{
         RowBox[{"(", 
          RowBox[{"1", "/", "2"}], ")"}], "*", 
         RowBox[{
          RowBox[{"Transpose", "[", 
           RowBox[{"Vec", "[", 
            RowBox[{"Transpose", "[", "Sig", "]"}], "]"}], "]"}], ".", "Dinv",
           ".", 
          RowBox[{"Vec", "[", "Sig", "]"}]}]}], "+", 
        RowBox[{"2", "*", 
         RowBox[{"dv", ".", "Kt", ".", "q", ".", 
          RowBox[{"Inverse", "[", "l", "]"}], ".", "qinv", ".", "dv"}]}]}], 
       "]"}]}], "\[IndentingNewLine]", ")"}]}], "\[IndentingNewLine]", 
   "\[IndentingNewLine]", "\[IndentingNewLine]", 
   RowBox[{"(*", 
    RowBox[{
     RowBox[{
      RowBox[{
       RowBox[{"Safranek", "'"}], "s", " ", "other", " ", 
       RowBox[{"paper", ":", " ", "https", ":"}]}], "//", 
      RowBox[{
       RowBox[{
        RowBox[{
         RowBox[{
          RowBox[{"iopscience", ".", "iop", ".", "org"}], "/", "article"}], 
         "/", "10.1088"}], "/", "1367"}], "-", 
       RowBox[{
        RowBox[{
         RowBox[{
          RowBox[{
           RowBox[{"2630", "/", "17"}], "/", "7"}], "/", "073016"}], "/", 
         "pdf"}], " ", "\[IndentingNewLine]", "gives", " ", "a", " ", 
        "formula", " ", "to", " ", "find", " ", "the", " ", "QFI", " ", "of", 
        " ", "a", " ", "two"}], "-", 
       RowBox[{"mode", " ", "state"}]}]}], ",", " ", 
     RowBox[{
     "below", " ", "is", " ", "a", " ", "funtion", " ", "for", " ", 
      "that"}]}], "*)"}], "\[IndentingNewLine]", "\[IndentingNewLine]", 
   RowBox[{"(*", 
    RowBox[{"A", "=", 
     RowBox[{"Ks", " ", "matrix"}]}], "*)"}], "\[IndentingNewLine]", 
   RowBox[{"(*", 
    RowBox[{
    "first", " ", "have", " ", "to", " ", "convert", " ", "to", " ", 
     "complex", " ", "form"}], "*)"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"Amat", "[", "s_", "]"}], ":=", 
    RowBox[{"(", 
     RowBox[{
      RowBox[{"len", "=", 
       RowBox[{
        RowBox[{"Length", "[", "s", "]"}], "/", "2"}]}], ";", 
      RowBox[{"sig", "=", 
       RowBox[{
        RowBox[{"U", "[", "s", "]"}], ".", "s", ".", 
        RowBox[{"ConjugateTranspose", "[", 
         RowBox[{"U", "[", "s", "]"}], "]"}]}]}], ";", " ", 
      "\[IndentingNewLine]", 
      RowBox[{"FullSimplify", "[", 
       RowBox[{
        RowBox[{"K", "[", "len", "]"}], ".", "sig"}], "]"}]}], ")"}]}], 
   "\[IndentingNewLine]", "\[IndentingNewLine]", 
   RowBox[{"(*", 
    RowBox[{
     RowBox[{"expression", " ", "for", " ", "the", " ", "two"}], "-", 
     RowBox[{"mode", " ", "QFI"}]}], "*)"}], "\[IndentingNewLine]", 
   RowBox[{"(*", 
    RowBox[{"s", ",", 
     RowBox[{
     "v", " ", "must", " ", "be", " ", "in", " ", "the", " ", "complex", " ", 
      "form"}]}], "*)"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"TMIQ", "[", 
     RowBox[{"s_", ",", "v_"}], "]"}], ":=", 
    RowBox[{"(", 
     RowBox[{
      RowBox[{"num2", "=", 
       RowBox[{"Length", "[", "s", "]"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"A", "=", 
       RowBox[{"FullSimplify", "[", 
        RowBox[{
         RowBox[{"Kmat", "[", "s", "]"}], ".", "s"}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"detA", "=", 
       RowBox[{"FullSimplify", "[", 
        RowBox[{"Det", "[", "A", "]"}], "]"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"A2", "=", 
       RowBox[{"FullSimplify", "[", 
        RowBox[{"MatrixPower", "[", 
         RowBox[{"A", ",", "2"}], "]"}], "]"}]}], ";", "\[IndentingNewLine]", 
      
      RowBox[{"dA", "=", 
       RowBox[{"FullSimplify", "[", 
        RowBox[{"D", "[", 
         RowBox[{"A", ",", "phi"}], "]"}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"trA2", "=", 
       RowBox[{"FullSimplify", "[", 
        RowBox[{"Tr", "[", "A2", "]"}], "]"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"invA", "=", 
       RowBox[{"FullSimplify", "[", 
        RowBox[{"Inverse", "[", "A", "]"}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"root", "=", 
       RowBox[{"FullSimplify", "[", 
        RowBox[{"Sqrt", "[", 
         RowBox[{
          RowBox[{"trA2", "^", "2"}], "-", 
          RowBox[{"16", "*", "detA"}]}], "]"}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"lam1", "=", 
       RowBox[{"FullSimplify", "[", 
        RowBox[{
         RowBox[{"(", 
          RowBox[{"1", "/", "2"}], ")"}], "*", 
         RowBox[{"Sqrt", "[", 
          RowBox[{"trA2", "+", "root"}], "]"}]}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"lam2", "=", 
       RowBox[{"FullSimplify", "[", 
        RowBox[{
         RowBox[{"(", 
          RowBox[{"1", "/", "2"}], ")"}], "*", 
         RowBox[{"Sqrt", "[", 
          RowBox[{"trA2", "-", "root"}], "]"}]}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"dlam1", "=", 
       RowBox[{"FullSimplify", "[", 
        RowBox[{"D", "[", 
         RowBox[{"lam1", ",", "phi"}], "]"}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"dlam2", "=", 
       RowBox[{"FullSimplify", "[", 
        RowBox[{"D", "[", 
         RowBox[{"lam2", ",", "phi"}], "]"}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"dv", "=", 
       RowBox[{"FullSimplify", "[", 
        RowBox[{"D", "[", 
         RowBox[{"v", ",", "phi"}], "]"}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"sinv", "=", 
       RowBox[{"FullSimplify", "[", 
        RowBox[{"Inverse", "[", "s", "]"}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"dT", "=", 
       RowBox[{"ArrayFlatten", "[", 
        RowBox[{"{", 
         RowBox[{
          RowBox[{"{", 
           RowBox[{"0", ",", 
            RowBox[{"id", "[", 
             RowBox[{"num2", "/", "2"}], "]"}]}], "}"}], ",", 
          RowBox[{"{", 
           RowBox[{
            RowBox[{"id", "[", 
             RowBox[{"num2", "/", "2"}], "]"}], ",", "0"}], "}"}]}], "}"}], 
        "]"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"FullSimplify", "[", 
       RowBox[{
        RowBox[{
         RowBox[{"(", 
          RowBox[{"1", "/", 
           RowBox[{"(", 
            RowBox[{"2", "*", 
             RowBox[{"(", 
              RowBox[{"detA", "-", "1"}], ")"}]}], ")"}]}], ")"}], "*", 
         RowBox[{"(", " ", 
          RowBox[{
           RowBox[{"detA", "*", 
            RowBox[{"Tr", "[", 
             RowBox[{"MatrixPower", "[", 
              RowBox[{
               RowBox[{"invA", ".", "dA"}], ",", "2"}], "]"}], "]"}]}], "+", 
           RowBox[{
            RowBox[{"Sqrt", "[", 
             RowBox[{"Det", "[", 
              RowBox[{
               RowBox[{"id", "[", "num2", "]"}], "+", "A2"}], "]"}], "]"}], 
            "*", 
            RowBox[{"Tr", "[", 
             RowBox[{"MatrixPower", "[", 
              RowBox[{
               RowBox[{
                RowBox[{"Inverse", "[", 
                 RowBox[{
                  RowBox[{"id", "[", "num2", "]"}], "+", "A2"}], "]"}], ".", 
                "dA"}], ",", "2"}], "]"}], "]"}]}], "+", 
           RowBox[{"4", "*", 
            RowBox[{"(", 
             RowBox[{
              RowBox[{"lam1", "^", "2"}], "-", 
              RowBox[{"lam2", "^", "2"}]}], ")"}], "*", 
            RowBox[{"(", 
             RowBox[{
              RowBox[{
               RowBox[{"-", 
                RowBox[{"(", 
                 RowBox[{"dlam1", "^", "2"}], ")"}]}], "/", 
               RowBox[{"(", 
                RowBox[{
                 RowBox[{"lam1", "^", "4"}], "-", "1"}], ")"}]}], "+", 
              RowBox[{
               RowBox[{"(", 
                RowBox[{"dlam2", "^", "2"}], ")"}], "/", 
               RowBox[{"(", 
                RowBox[{
                 RowBox[{"lam2", "^", "4"}], "-", "1"}], ")"}]}]}], ")"}]}]}],
           ")"}]}], "+", 
        RowBox[{"2", "*", 
         RowBox[{"dv", ".", "dT", ".", "sinv", ".", "dv"}]}]}], "]"}]}], 
     "\[IndentingNewLine]", ")"}]}], "\[IndentingNewLine]", 
   "\[IndentingNewLine]"}]}]], "Input",
 CellChangeTimes->{{3.901700233135499*^9, 3.9017002540896587`*^9}, {
   3.901700286542864*^9, 3.901700300722186*^9}, {3.9017006511072063`*^9, 
   3.9017006588055763`*^9}, {3.901701168656406*^9, 3.901701169112866*^9}, {
   3.9017013732287416`*^9, 3.901701373796261*^9}, 3.901702104292736*^9, {
   3.901702290559888*^9, 3.901702299237015*^9}, {3.901702964658203*^9, 
   3.901703063119514*^9}, {3.901703109797351*^9, 3.9017031450314627`*^9}, {
   3.901703302552782*^9, 3.901703311802142*^9}, {3.901703727332507*^9, 
   3.9017037279599333`*^9}, {3.9019771458085537`*^9, 3.901977211493086*^9}, {
   3.901977269041444*^9, 3.901977273207201*^9}, {3.901977371008849*^9, 
   3.901977567512051*^9}, {3.9019776030247517`*^9, 3.90197761323781*^9}, {
   3.90197764458582*^9, 3.9019777032299967`*^9}, {3.9019777732553253`*^9, 
   3.901977793838982*^9}, {3.901977834343453*^9, 3.901977876569982*^9}, {
   3.901978275323986*^9, 3.901978331870305*^9}, {3.9019784392215652`*^9, 
   3.9019784623027687`*^9}, {3.901978501757983*^9, 3.901978502453198*^9}, {
   3.9019791516574078`*^9, 3.901979294024419*^9}, {3.90197953119928*^9, 
   3.901979536507996*^9}, {3.901979612206265*^9, 3.901979648378251*^9}, {
   3.901979704137981*^9, 3.901979751443063*^9}, {3.901979846592452*^9, 
   3.901979982736614*^9}, {3.90198003100356*^9, 3.901980066966477*^9}, {
   3.9019804928782663`*^9, 3.9019804949871607`*^9}, 3.9019805939191227`*^9, {
   3.90198084642863*^9, 3.9019808515263643`*^9}, {3.9019812615060596`*^9, 
   3.9019812618985233`*^9}, 3.901981875747196*^9, {3.9019830767610407`*^9, 
   3.901983094820443*^9}, {3.909680382419701*^9, 
   3.909680384040709*^9}},ExpressionUUID->"a68bd31d-c551-4846-8364-\
b2bfc7b680cb"],

Cell[CellGroupData[{

Cell[BoxData[
 RowBox[{"\[IndentingNewLine]", 
  RowBox[{"(*", 
   RowBox[{
    RowBox[{"for", " ", "example"}], ",", " ", 
    RowBox[{
    "here", " ", "we", " ", "find", " ", "the", " ", "QFI", " ", "of", " ", 
     RowBox[{"Yurke", "/", "Mandel"}], " ", "with", " ", "internal", " ", 
     "loss"}]}], "*)"}], "\[IndentingNewLine]", 
  RowBox[{"(*", 
   RowBox[{
    RowBox[{"don", "'"}], "t", " ", "forget", " ", "to", " ", "convert", " ", 
    "to", " ", "the", " ", "complex", " ", "form", " ", "first", " ", "using",
     " ", "U"}], "*)"}], "\[IndentingNewLine]", 
  RowBox[{"(*", 
   RowBox[{
    RowBox[{
    "the", " ", "conversion", " ", "to", " ", "the", " ", "complex", " ", 
     "form", " ", "is", " ", "seperate", " ", "since", " ", "I", " ", 
     "originally", " ", "found", " ", "the", " ", "QFI", " ", "in", " ", 
     "the", " ", "real", " ", "form"}], ",", " ", 
    RowBox[{
    "but", " ", "then", " ", "switched", " ", "since", " ", "the", " ", 
     "complex", " ", "form", " ", "tends", " ", "to", " ", "have", " ", 
     "more", " ", "zero", " ", "entries"}], ",", " ", 
    RowBox[{"leading", " ", "to", " ", "faster", " ", "computation"}]}], 
   "*)"}], "\[IndentingNewLine]", 
  RowBox[{"(*", 
   RowBox[{
    RowBox[{
    "you", " ", "may", " ", "find", " ", "it", " ", "more", " ", 
     "convienient", " ", "to", " ", "edit", " ", "the", " ", "interferometer",
      " ", "functions", " ", "so", " ", "they", " ", "include", " ", "the", 
     " ", "switch", " ", "to", " ", "the", " ", "complex", " ", "form"}], ",",
     " ", 
    RowBox[{
    "BUT", " ", "BE", " ", "WARY", " ", "since", " ", "the", " ", "funtion", 
     " ", "for", " ", "the", " ", "QFI", " ", "of", " ", "a", " ", "pure", 
     " ", "state", " ", "still", " ", "uses", " ", "the", " ", "real", " ", 
     "form"}]}], "*)"}], "\[IndentingNewLine]", "\[IndentingNewLine]", 
  RowBox[{
   RowBox[{
    RowBox[{"psi", "=", 
     RowBox[{"YMI", "[", 
      RowBox[{"s0", ",", "v0", ",", "r1", ",", "t1", ",", "T"}], "]"}]}], 
    ";"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"sr", "=", 
     RowBox[{"psi", "[", 
      RowBox[{"[", "1", "]"}], "]"}]}], ";"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"s", "=", 
     RowBox[{"FullSimplify", "[", 
      RowBox[{
       RowBox[{"U", "[", "sr", "]"}], ".", "sr", ".", 
       RowBox[{"ConjugateTranspose", "[", 
        RowBox[{"U", "[", "sr", "]"}], "]"}]}], "]"}]}], ";"}], 
   "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"vr", "=", 
     RowBox[{"psi", "[", 
      RowBox[{"[", "2", "]"}], "]"}]}], ";"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"v", "=", 
     RowBox[{"FullSimplify", "[", 
      RowBox[{
       RowBox[{"U", "[", "vr", "]"}], ".", "vr"}], "]"}]}], ";"}], 
   "\[IndentingNewLine]", 
   RowBox[{"CIQ", "[", 
    RowBox[{"s", ",", "v"}], "]"}]}]}]], "Input",
 CellChangeTimes->{{3.901700233135499*^9, 3.9017002540896587`*^9}, {
   3.901700286542864*^9, 3.901700300722186*^9}, {3.9017006511072063`*^9, 
   3.9017006588055763`*^9}, {3.901701168656406*^9, 3.901701169112866*^9}, {
   3.9017013732287416`*^9, 3.901701373796261*^9}, {3.901702104292736*^9, 
   3.901702129725243*^9}, 3.9017026469564962`*^9, {3.901702716149147*^9, 
   3.901702719574081*^9}, {3.901702757436741*^9, 3.901702757727582*^9}, {
   3.901977081429117*^9, 3.901977131339699*^9}, {3.9019779093063726`*^9, 
   3.901977956610899*^9}, {3.9019780096407423`*^9, 3.901978060161625*^9}, {
   3.9019781040727997`*^9, 3.9019781352013197`*^9}, {3.9019797599674807`*^9, 
   3.901979765651671*^9}, {3.901980413613559*^9, 3.9019804165558567`*^9}},
 CellLabel->
  "In[169]:=",ExpressionUUID->"e1fe9013-cdd0-4ad2-8ed1-03ec0942b6ff"],

Cell[BoxData[
 RowBox[{"{", 
  RowBox[{"{", 
   RowBox[{"T", " ", 
    RowBox[{"(", 
     RowBox[{
      RowBox[{
       RowBox[{"(", 
        RowBox[{"4", " ", 
         SuperscriptBox["\[ExponentialE]", 
          RowBox[{
           RowBox[{"-", "\[ImaginaryI]"}], " ", "t1"}]], " ", 
         RowBox[{"(", 
          RowBox[{
           RowBox[{
            RowBox[{"(", 
             RowBox[{"a1", "-", 
              RowBox[{"\[ImaginaryI]", " ", "a2"}]}], ")"}], " ", 
            SuperscriptBox["\[ExponentialE]", 
             RowBox[{"\[ImaginaryI]", " ", "t1"}]], " ", 
            RowBox[{"Cosh", "[", "r1", "]"}]}], "-", 
           RowBox[{
            RowBox[{"(", 
             RowBox[{"b1", "+", 
              RowBox[{"\[ImaginaryI]", " ", "b2"}]}], ")"}], " ", 
            RowBox[{"Sinh", "[", "r1", "]"}]}]}], ")"}], " ", 
         RowBox[{"(", 
          RowBox[{
           RowBox[{"-", 
            RowBox[{"(", 
             RowBox[{
              RowBox[{"(", 
               RowBox[{"a1", "+", 
                RowBox[{"\[ImaginaryI]", " ", "a2"}]}], ")"}], " ", 
              RowBox[{"Cosh", "[", "r1", "]"}]}], ")"}]}], "+", 
           RowBox[{
            RowBox[{"(", 
             RowBox[{"b1", "-", 
              RowBox[{"\[ImaginaryI]", " ", "b2"}]}], ")"}], " ", 
            SuperscriptBox["\[ExponentialE]", 
             RowBox[{"\[ImaginaryI]", " ", "t1"}]], " ", 
            RowBox[{"Sinh", "[", "r1", "]"}]}]}], ")"}], " ", 
         RowBox[{"(", 
          RowBox[{"1", "+", 
           RowBox[{"2", " ", "T", " ", 
            SuperscriptBox[
             RowBox[{"Sinh", "[", "r1", "]"}], "2"]}]}], ")"}]}], ")"}], "/", 
       
       RowBox[{"(", 
        RowBox[{
         RowBox[{"-", "1"}], "-", 
         RowBox[{"2", " ", 
          RowBox[{"(", 
           RowBox[{
            RowBox[{"-", "1"}], "+", "T"}], ")"}], " ", "T"}], "+", 
         RowBox[{"2", " ", 
          RowBox[{"(", 
           RowBox[{
            RowBox[{"-", "1"}], "+", "T"}], ")"}], " ", "T", " ", 
          RowBox[{"Cosh", "[", 
           RowBox[{"2", " ", "r1"}], "]"}]}]}], ")"}]}], "-", 
      FractionBox[
       RowBox[{"T", " ", 
        SuperscriptBox[
         RowBox[{"Sinh", "[", 
          RowBox[{"2", " ", "r1"}], "]"}], "2"]}], 
       RowBox[{
        RowBox[{"-", "1"}], "+", "T", "-", 
        SuperscriptBox["T", "2"], "+", 
        RowBox[{
         RowBox[{"(", 
          RowBox[{
           RowBox[{"-", "1"}], "+", "T"}], ")"}], " ", "T", " ", 
         RowBox[{"Cosh", "[", 
          RowBox[{"2", " ", "r1"}], "]"}]}]}]]}], ")"}]}], "}"}], 
  "}"}]], "Output",
 CellChangeTimes->{3.901980423011402*^9, 3.9019805093235073`*^9},
 CellLabel->
  "Out[174]=",ExpressionUUID->"0300ba6c-a832-489d-a5c2-eade14c3c6e8"]
}, Open  ]],

Cell[CellGroupData[{

Cell[BoxData[
 RowBox[{"\[IndentingNewLine]", 
  RowBox[{"(*", 
   RowBox[{
   "we", " ", "can", " ", "also", " ", "find", " ", "the", " ", "QFI", " ", 
    "when", " ", "there", " ", "is", " ", "no", " ", "loss"}], "*)"}], 
  "\[IndentingNewLine]", 
  RowBox[{"(*", 
   RowBox[{
   "for", " ", "the", " ", "function", " ", "PureIQ", " ", "we", " ", "use", 
    " ", "the", " ", "real", " ", "form"}], "*)"}], "\[IndentingNewLine]", 
  RowBox[{
   RowBox[{
    RowBox[{"psi", "=", 
     RowBox[{"YMI", "[", 
      RowBox[{"s0", ",", "v0", ",", "r1", ",", "t1", ",", "1"}], "]"}]}], 
    ";"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"sr", "=", 
     RowBox[{"psi", "[", 
      RowBox[{"[", "1", "]"}], "]"}]}], ";"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"vr", "=", 
     RowBox[{"psi", "[", 
      RowBox[{"[", "2", "]"}], "]"}]}], ";"}], "\[IndentingNewLine]", 
   RowBox[{"PureIQ", "[", 
    RowBox[{"sr", ",", "vr", ",", "phi"}], "]"}]}]}]], "Input",
 CellChangeTimes->{{3.901700233135499*^9, 3.9017002540896587`*^9}, {
   3.901700286542864*^9, 3.901700300722186*^9}, {3.9017006511072063`*^9, 
   3.9017006588055763`*^9}, {3.901701168656406*^9, 3.901701169112866*^9}, {
   3.9017013732287416`*^9, 3.901701373796261*^9}, {3.901702104292736*^9, 
   3.901702129725243*^9}, 3.9017026469564962`*^9, {3.901702716149147*^9, 
   3.901702719574081*^9}, {3.901702757436741*^9, 3.901702757727582*^9}, {
   3.901977081429117*^9, 3.901977131339699*^9}, {3.9019779093063726`*^9, 
   3.901977956610899*^9}, {3.9019780096407423`*^9, 3.901978060161625*^9}, {
   3.9019781040727997`*^9, 3.9019781352013197`*^9}, {3.9019797599674807`*^9, 
   3.901979765651671*^9}, {3.901980413613559*^9, 3.9019804165558567`*^9}, {
   3.90198180713157*^9, 3.9019818311152782`*^9}, {3.901981891293591*^9, 
   3.901981903513062*^9}, {3.901982797145507*^9, 3.9019828129142857`*^9}, {
   3.901983062767315*^9, 3.901983063097815*^9}, {3.901983104929878*^9, 
   3.9019831402294483`*^9}, {3.901983533155905*^9, 
   3.901983550719097*^9}},ExpressionUUID->"2266d6ed-85df-4935-a86d-\
cbfa068ccece"],

Cell[BoxData[
 RowBox[{
  RowBox[{"-", 
   FractionBox["1", "2"]}], "+", 
  SuperscriptBox["a1", "2"], "+", 
  SuperscriptBox["a2", "2"], "+", 
  SuperscriptBox["b1", "2"], "+", 
  SuperscriptBox["b2", "2"], "+", 
  RowBox[{"2", " ", 
   RowBox[{"(", 
    RowBox[{
     SuperscriptBox["a1", "2"], "+", 
     SuperscriptBox["a2", "2"], "-", 
     SuperscriptBox["b1", "2"], "-", 
     SuperscriptBox["b2", "2"]}], ")"}], " ", 
   RowBox[{"Cosh", "[", 
    RowBox[{"2", " ", "r1"}], "]"}]}], "+", 
  RowBox[{
   RowBox[{"(", 
    RowBox[{
     FractionBox["1", "2"], "+", 
     SuperscriptBox["a1", "2"], "+", 
     SuperscriptBox["a2", "2"], "+", 
     SuperscriptBox["b1", "2"], "+", 
     SuperscriptBox["b2", "2"]}], ")"}], " ", 
   RowBox[{"Cosh", "[", 
    RowBox[{"4", " ", "r1"}], "]"}]}], "-", 
  RowBox[{"8", " ", "a1", " ", "b1", " ", 
   RowBox[{"Cos", "[", "t1", "]"}], " ", 
   SuperscriptBox[
    RowBox[{"Cosh", "[", "r1", "]"}], "3"], " ", 
   RowBox[{"Sinh", "[", "r1", "]"}]}], "+", 
  RowBox[{"8", " ", "a2", " ", "b2", " ", 
   RowBox[{"Cos", "[", "t1", "]"}], " ", 
   SuperscriptBox[
    RowBox[{"Cosh", "[", "r1", "]"}], "3"], " ", 
   RowBox[{"Sinh", "[", "r1", "]"}]}], "-", 
  RowBox[{"8", " ", "a2", " ", "b1", " ", 
   SuperscriptBox[
    RowBox[{"Cosh", "[", "r1", "]"}], "3"], " ", 
   RowBox[{"Sin", "[", "t1", "]"}], " ", 
   RowBox[{"Sinh", "[", "r1", "]"}]}], "-", 
  RowBox[{"8", " ", "a1", " ", "b2", " ", 
   SuperscriptBox[
    RowBox[{"Cosh", "[", "r1", "]"}], "3"], " ", 
   RowBox[{"Sin", "[", "t1", "]"}], " ", 
   RowBox[{"Sinh", "[", "r1", "]"}]}], "-", 
  RowBox[{"8", " ", "a1", " ", "b1", " ", 
   RowBox[{"Cos", "[", "t1", "]"}], " ", 
   RowBox[{"Cosh", "[", "r1", "]"}], " ", 
   SuperscriptBox[
    RowBox[{"Sinh", "[", "r1", "]"}], "3"]}], "+", 
  RowBox[{"8", " ", "a2", " ", "b2", " ", 
   RowBox[{"Cos", "[", "t1", "]"}], " ", 
   RowBox[{"Cosh", "[", "r1", "]"}], " ", 
   SuperscriptBox[
    RowBox[{"Sinh", "[", "r1", "]"}], "3"]}], "-", 
  RowBox[{"8", " ", "a2", " ", "b1", " ", 
   RowBox[{"Cosh", "[", "r1", "]"}], " ", 
   RowBox[{"Sin", "[", "t1", "]"}], " ", 
   SuperscriptBox[
    RowBox[{"Sinh", "[", "r1", "]"}], "3"]}], "-", 
  RowBox[{"8", " ", "a1", " ", "b2", " ", 
   RowBox[{"Cosh", "[", "r1", "]"}], " ", 
   RowBox[{"Sin", "[", "t1", "]"}], " ", 
   SuperscriptBox[
    RowBox[{"Sinh", "[", "r1", "]"}], "3"]}]}]], "Output",
 CellChangeTimes->{{3.901983117485816*^9, 3.901983145256908*^9}},
 CellLabel->
  "Out[455]=",ExpressionUUID->"9509f38d-f202-4e14-9faa-e76b2e77e5b1"]
}, Open  ]],

Cell[BoxData[
 RowBox[{
  RowBox[{"(*", 
   RowBox[{
   "sometimes", " ", "there", " ", "is", " ", "a", " ", "pure", " ", "mode", 
    " ", "even", " ", "if", " ", "there", " ", "is", " ", "loss"}], "*)"}], 
  "\[IndentingNewLine]", 
  RowBox[{"(*", 
   RowBox[{
   "you", " ", "can", " ", "tell", " ", "if", " ", "there", " ", "are", " ", 
    "pure", " ", "modes", " ", "by", " ", "how", " ", "many", " ", 
    "eigenvalues", " ", "of", " ", "sK", " ", "are", " ", "equal", " ", "to", 
    " ", "1"}], "*)"}], "\[IndentingNewLine]", 
  RowBox[{"(*", 
   RowBox[{
    RowBox[{
    "if", " ", "there", " ", "are", " ", "some", " ", "pure", " ", "modes", 
     " ", "and", " ", "some", " ", "mixed", " ", "modes"}], ",", " ", 
    RowBox[{
    "you", " ", "can", " ", "find", " ", "the", " ", "QFI", " ", "by", " ", 
     "performing", " ", "a", " ", "regularization", " ", 
     RowBox[{"procedure", ":", " ", 
      RowBox[{
      "multiply", " ", "the", " ", "covariance", " ", "matrix", " ", "by", 
       " ", "some", " ", "parameter", " ", "a"}]}]}], ",", " ", 
    RowBox[{
     RowBox[{"then", " ", "take", " ", "the", " ", "limit", " ", "a"}], "->", 
     
     RowBox[{
     "1", " ", "after", " ", "evaluating", " ", "the", " ", "QFI", " ", "for",
       " ", "a", " ", "mixed", " ", "state"}]}]}], "*)"}], 
  "\[IndentingNewLine]", "\[IndentingNewLine]", 
  RowBox[{"(*", 
   RowBox[{
    RowBox[{
    "another", " ", "issue", " ", "that", " ", "can", " ", "occur", " ", "is",
      " ", "that", " ", "Mathematica", " ", "does", " ", "not", " ", "find", 
     " ", "all", " ", "the", " ", "eigenvectors"}], ",", " ", 
    RowBox[{
    "or", " ", "that", " ", "the", " ", "eigenvectors", " ", "have", " ", 
     "an", " ", "overly", " ", "complicated", " ", "expression"}]}], "*)"}], 
  "\[IndentingNewLine]", 
  RowBox[{"(*", 
   RowBox[{
    RowBox[{
    "to", " ", "get", " ", "around", " ", "this", " ", "you", " ", "can", " ",
      "find", " ", "the", " ", "eigenvalues", " ", "manually"}], ",", " ", 
    RowBox[{
    "then", " ", "solve", " ", "the", " ", "eigenvector", " ", "equation", 
     " ", "manually"}]}], "*)"}], "\[IndentingNewLine]", 
  RowBox[{"(*", 
   RowBox[{
    RowBox[{
     RowBox[{"you", " ", "must", " ", "solve", " ", 
      RowBox[{"sK", ".", "v"}]}], "=", 
     RowBox[{"lamda", "*", "v", " ", "using", " ", 
      RowBox[{"Solve", "[", "]"}], " ", "and", " ", "then", " ", "set", " ", 
      "the", " ", "free", " ", "variables", " ", "to", " ", "1", " ", "to", 
      " ", "get", " ", "the", " ", "eigenvectors"}]}], ",", " ", 
    RowBox[{"DO", " ", "NOT", " ", "use", " ", 
     RowBox[{"Nullspace", "[", "]"}], " ", "or", " ", "the", " ", "same", " ",
      "problem", " ", "will", " ", "likely", " ", "occur"}]}], "*)"}], 
  "\[IndentingNewLine]", "\[IndentingNewLine]", 
  RowBox[{"(*", 
   RowBox[{
    RowBox[{
    "the", " ", "Notebook", " ", "\"\<Mandel all Modes Calculation\>\"", " ", 
     "deals", " ", "with", " ", "both", " ", "of", " ", "these", " ", 
     "problems"}], ",", " ", 
    RowBox[{
    "and", " ", "also", " ", "shows", " ", "optimization", " ", "of", " ", 
     "the", " ", "QFI"}]}], "*)"}]}]], "Input",
 CellChangeTimes->{{3.901983161322832*^9, 3.901983314010867*^9}, {
  3.901983365411697*^9, 3.901983402794333*^9}, {3.901983453462184*^9, 
  3.9019835128320093`*^9}, {3.9019835581794233`*^9, 3.901983729861693*^9}, {
  3.901984122811626*^9, 3.9019841532681427`*^9}, {3.901984205136529*^9, 
  3.9019842258772497`*^9}, {3.901984258737958*^9, 
  3.9019842729022493`*^9}},ExpressionUUID->"72691dc1-5f4f-44e8-9e42-\
5a60584b912e"]
},
WindowSize->{808, 711},
WindowMargins->{{Automatic, 280}, {Automatic, 0}},
FrontEndVersion->"13.1 for Mac OS X ARM (64-bit) (June 16, 2022)",
StyleDefinitions->"Default.nb",
ExpressionUUID->"55607fb6-22dc-4b06-b918-4334de2c38e3"
]
(* End of Notebook Content *)

(* Internal cache information *)
(*CellTagsOutline
CellTagsIndex->{}
*)
(*CellTagsIndex
CellTagsIndex->{}
*)
(*NotebookFileOutline
Notebook[{
Cell[558, 20, 62322, 1605, 7008, "Input",ExpressionUUID->"a68bd31d-c551-4846-8364-b2bfc7b680cb"],
Cell[CellGroupData[{
Cell[62905, 1629, 3685, 81, 368, "Input",ExpressionUUID->"e1fe9013-cdd0-4ad2-8ed1-03ec0942b6ff"],
Cell[66593, 1712, 2768, 78, 126, "Output",ExpressionUUID->"0300ba6c-a832-489d-a5c2-eade14c3c6e8"]
}, Open  ]],
Cell[CellGroupData[{
Cell[69398, 1795, 2076, 42, 157, "Input",ExpressionUUID->"2266d6ed-85df-4935-a86d-cbfa068ccece"],
Cell[71477, 1839, 2549, 69, 173, "Output",ExpressionUUID->"9509f38d-f202-4e14-9faa-e76b2e77e5b1"]
}, Open  ]],
Cell[74041, 1911, 3603, 78, 367, "Input",ExpressionUUID->"72691dc1-5f4f-44e8-9e42-5a60584b912e"]
}
]
*)

